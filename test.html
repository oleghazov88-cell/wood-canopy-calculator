<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Калькулятор навесов</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,500,600,700,800&subset=latin,cyrillic-ext" rel="stylesheet">
    
    <!-- Стили из папки calc -->
    <link rel="stylesheet" href="calc/css/calc/fonts/stylesheet.css">
    <link rel="stylesheet" href="calc/js/calc/jquery-ui-1.14.1/jquery-ui.min.css">
    <link rel="stylesheet" href="calc/css/calc/style.css">
    <link rel="stylesheet" href="calc/css/calc/responsive.css">
    
    <style>
        /* CSS переменные */
        :root {
            /* Цвета */
            --primary-color: #20B5B9;
            --secondary-color: #FF6B6B;
            --text-dark: #2c3e50;
            --text-light: #3E414A;
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --border-color: #e9ecef;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --shadow-hover: 0 15px 40px rgba(0,0,0,0.15);
            
            /* Размеры */
            --container-padding: 40px;
            --border-radius: 20px;
            --border-radius-small: 10px;
            --gap-large: 40px;
            --gap-medium: 20px;
            --gap-small: 15px;
            
            /* Типографика */
            --font-family-primary: "Manrope", "Open Sans", Arial, sans-serif;
            --font-family-heading: "Unbounded", "Open Sans", Arial, sans-serif;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-base: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-2xl: 24px;
            --font-size-3xl: 30px;
            --font-size-4xl: 36px;
            --font-size-5xl: 48px;
            
            /* Брейкпоинты */
            --breakpoint-sm: 576px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 992px;
            --breakpoint-xl: 1200px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-primary);
            background: var(--bg-white);
            color: var(--text-light);
            line-height: 1.6;
            font-size: var(--font-size-base);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .f2 {
            font-family: var(--font-family-heading);
            line-height: 1.4;
        }

        /* Утилиты для размеров шрифтов */
        .text-xs { font-size: var(--font-size-xs); }
        .text-sm { font-size: var(--font-size-sm); }
        .text-base { font-size: var(--font-size-base); }
        .text-lg { font-size: var(--font-size-lg); }
        .text-xl { font-size: var(--font-size-xl); }
        .text-2xl { font-size: var(--font-size-2xl); }
        .text-3xl { font-size: var(--font-size-3xl); }
        .text-4xl { font-size: var(--font-size-4xl); }
        .text-5xl { font-size: var(--font-size-5xl); }
        
        /* Обратная совместимость со старыми классами */
        .fz11 { font-size: var(--font-size-xs); }
        .fz12 { font-size: var(--font-size-xs); }
        .fz13 { font-size: var(--font-size-sm); }
        .fz14 { font-size: var(--font-size-sm); }
        .fz15 { font-size: var(--font-size-sm); }
        .fz16 { font-size: var(--font-size-base); }
        .fz17 { font-size: var(--font-size-base); }
        .fz18 { font-size: var(--font-size-lg); }
        .fz20 { font-size: var(--font-size-xl); }
        .fz22 { font-size: var(--font-size-xl); }
        .fz25 { font-size: var(--font-size-2xl); }
        .fz30 { font-size: var(--font-size-3xl); }
        .fz35 { font-size: var(--font-size-4xl); }
        .fz40 { font-size: var(--font-size-4xl); }

        .container {
            width: 100%;
            margin: 0;
            padding: var(--container-padding);
            box-sizing: border-box;
        }

        .calc-title {
            font-size: var(--font-size-5xl);
            font-weight: 800;
            text-transform: uppercase;
            line-height: 1.1;
            margin-bottom: 60px;
            color: var(--text-dark);
            text-align: center;
            letter-spacing: 1px;
        }

        /* Скрываем верхний заголовок на больших экранах для экономии места */
        @media (min-width: 993px) {
            .title-f2.hide_cl.show_992 {
                display: none;
            }
        }

        .calculator-row {
            display: flex;
            gap: var(--gap-large);
            margin-bottom: 80px;
            flex-wrap: nowrap;
            align-items: flex-start;
            justify-content: flex-start;
            width: 100%;
            min-height: 100vh;
        }

        .calculator-left {
            flex: 0 0 40%;
            min-width: 450px;
            max-width: 700px;
            background: var(--bg-white);
            border-radius: var(--border-radius);
            padding: 35px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: box-shadow 0.3s ease;
            height: fit-content;
        }

        .calculator-left:hover {
            box-shadow: var(--shadow-hover);
        }

        .calculator-date {
            margin-bottom: 35px;
        }

        .calculator-date-item {
            margin-bottom: 55px;
        }

        .calculator-date-item--type .name {
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            line-height: 1.3;
            margin-bottom: 30px;
            color: #000000;
        }

        .type-row-raido {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .type-row-raido-col {
            flex: 0 0 auto;
        }

        .raido-image input[type="radio"] {
            display: none;
        }

        .raido-image label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 80px;
            height: 80px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 24px;
        }

        .raido-image input[type="radio"]:checked + label {
            background: #ffffff;
            border-color: #20b5b9;
            transform: scale(1.05);
            box-shadow: 0 0 0 3px rgba(32, 181, 185, 0.1);
        }

        .calculator-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 35px;
        }

        .calculator-list dl {
            flex: 1;
            min-width: 200px;
        }

        .calculator-list .name {
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            line-height: 1.3;
            margin-bottom: 15px;
            color: #000000;
        }


        /* Стили для слайдеров из папки calc */
        .ui-slider-horizontal .ui-slider-handle {
            width: 18px !important;
            height: 18px !important;
            border: 3px solid #EB1B24 !important;
            background: #fff !important;
            top: -6px !important;
            margin-left: -4px !important;
            border-radius: 50% !important;
            cursor: pointer !important;
        }

        .ui-slider-horizontal {
            height: 6px !important;
            background: #e9ecef !important;
            border: none !important;
            border-radius: 3px !important;
        }

        .ui-slider-horizontal .ui-slider-handle:focus,
        .ui-slider-horizontal .ui-slider-handle:focus-visible {
            outline: none !important;
        }

        .ui-slider-horizontal .ui-slider-range {
            background: #EB1B24 !important;
            border-radius: 3px !important;
        }

        /* Слайдеры используют стили из calc.css - удаляем дублирующие стили */

        .ot, .do {
            font-size: 17px;
            color: #666;
            flex: 0 0 auto;
        }

        .value {
            font-size: 20px;
            font-weight: 600;
            text-align: center;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slider {
            position: absolute;
            bottom: 10px;
            left: 20px;
            right: 20px;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
            z-index: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #20b5b9, #62d2d5);
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(32, 181, 185, 0.4);
            border: 3px solid white;
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(32, 181, 185, 0.5);
        }

        /* Поддержка Firefox */
        .slider::-moz-range-track {
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            border: none;
        }

        .slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #20b5b9, #62d2d5);
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(32, 181, 185, 0.4);
            border: 3px solid white;
            transition: all 0.3s ease;
        }

        .slider::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 20px rgba(32, 181, 185, 0.5);
        }

        /* Стили для контейнера слайдера */
        .has-slider {
            position: relative;
            background: var(--bg-light);
            border-radius: var(--border-radius-small);
            padding: 15px 20px 40px;
            margin: 10px 0;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .has-slider .ot,
        .has-slider .do {
            font-size: var(--font-size-xs);
            color: var(--text-light);
            text-align: center;
            line-height: 1.2;
        }

        .has-slider .value {
            font-weight: 600;
            font-size: var(--font-size-lg);
            color: var(--primary-color);
        }

        .has-slider .ui-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
        }

        .calculator-right {
            flex: 0 0 50%;
            min-width: 350px;
            display: flex;
            flex-direction: column;
        }

        .calculator-right-img-block {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.12);
            border: 1px solid #e9ecef;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .price {
            font-size: 42px;
            font-weight: 800;
            text-transform: uppercase;
            line-height: 1;
            color: #e74c3c;
            margin-bottom: 25px;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(231, 76, 60, 0.2);
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            width: 100%;
            text-align: center;
            border: none;
            cursor: pointer;
        }

        .btn-60 {
            height: 60px;
            padding: 0 20px;
        }

        .bg-red {
            background: linear-gradient(90deg, #20b5b9 0%, #62d2d5 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(32, 181, 185, 0.4);
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .bg-pink {
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
            color: #e74c3c;
            border: 2px solid #e74c3c;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
        }

        .bg-red:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(32, 181, 185, 0.5);
        }

        .bg-pink:hover {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .total-data {
            font-size: 18px;
            font-weight: 600;
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }

        .total-data-row {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }

        .total-data-col {
            flex: 1;
            min-width: 200px;
        }

        .total-data-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .total-data-item:last-child {
            border-bottom: none;
        }

        .specification {
            background: #f8f9fa;
            padding: 60px 40px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            margin-top: 60px;
        }

        .specification h2 {
            font-size: 30px;
            font-weight: 700;
            text-transform: uppercase;
            line-height: 1.2;
            margin-bottom: 30px;
            color: #000000;
        }

        .select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
        }

        .select:focus {
            border-color: #20b5b9;
            box-shadow: 0 0 0 3px rgba(32, 181, 185, 0.1);
            outline: none;
        }

        .field-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 40px;
        }

        .field-col {
            flex: 1;
            min-width: 200px;
        }

        .label_cl {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #000000;
        }

        .excel-integration {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #2e7d32;
        }

        .excel-integration input[type="file"] {
            margin-left: 10px;
        }

        .calculator-hide-date {
            margin-bottom: 10px;
        }

        .triger-open {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 24px;
            font-weight: 700;
            text-transform: uppercase;
            line-height: 1.1;
            cursor: pointer;
            padding: 25px;
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border-radius: 15px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            color: #2c3e50;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .triger-open:hover {
            border-color: #20b5b9;
            box-shadow: 0 6px 25px rgba(32, 181, 185, 0.15);
            transform: translateY(-2px);
        }

        .arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #20b5b9, #62d2d5);
            border-radius: 50%;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(32, 181, 185, 0.3);
        }

        .triger-open.active .arrow {
            transform: rotate(180deg);
        }

        .calculator-hide-info {
            display: none;
            padding-top: 40px;
        }

        .calculator-hide-info.active {
            display: block;
        }

        .images-block {
            position: relative;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
            flex: 1;
            min-height: 400px;
            overflow: hidden;
        }

        .images-block canvas {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        .images-button {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 15px;
            z-index: 2;
        }

        .save_btn, .zoom_btn {
            width: 40px;
            height: 40px;
            background: rgba(220, 53, 69, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 2px solid white;
        }

        .save_btn:hover, .zoom_btn:hover {
            background: #dc3545;
            transform: scale(1.1);
        }

        .link-360 {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 18px;
            font-weight: 500;
            color: #666;
            text-decoration: none;
        }

        .scroll-link {
            font-size: 13px;
            font-weight: 500;
            color: #dc3545;
            text-decoration: none;
        }

        .scroll-link:hover {
            text-decoration: underline;
        }

        .specification dl {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
        }

        .specification dt {
            display: flex;
            align-items: center;
            padding: 20px 25px;
            background: white;
            cursor: pointer;
            border-bottom: 1px solid #e9ecef;
        }

        .specification dt:hover {
            background: #f9f9f9;
        }

        .specification .num {
            color: #EB1B24;
            font-weight: 600;
            margin-right: 15px;
        }

        .specification .name {
            font-size: 18px;
            font-weight: 600;
            line-height: 1.2;
            text-transform: uppercase;
            flex: 1;
        }

        .specification .arrow {
            flex: 0 0 auto;
            transition: transform 0.3s ease;
        }

        .specification dt.active .arrow {
            transform: rotate(180deg);
        }

        .specification dd {
            display: none;
            padding: 0;
            background: white;
        }

        .specification dd.active {
            display: block;
        }

        .specification ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .specification li {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            border-bottom: 1px solid #f5f5f5;
        }

        .specification li:last-child {
            border-bottom: none;
        }

        .specification li .num {
            color: #666;
            font-weight: 500;
            margin-right: 15px;
            min-width: 30px;
        }

        .specification .parameter {
            flex: 1;
            color: #333;
        }

        .specification .value {
            font-weight: 600;
            color: #000;
            margin-left: auto;
        }

        /* Стили для правого блока с 3D */
        .calculator-right {
            flex: 1;
            min-width: 600px;
            position: relative;
            height: 100vh;
            overflow: hidden;
        }

        .calculator-right-img-block {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: var(--bg-white);
            border-radius: 0;
            padding: var(--container-padding);
            box-shadow: none;
            border: none;
            transition: box-shadow 0.3s ease;
        }

        .calculator-right-img-block:hover {
            box-shadow: var(--shadow-hover);
        }

        .images-block {
            flex: 1;
            min-height: calc(100vh - 200px);
            position: relative;
            border-radius: var(--border-radius-small);
            overflow: hidden;
            background: var(--bg-light);
            margin-top: var(--gap-medium);
        }

        .images-button {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .save_btn, .zoom_btn {
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .save_btn:hover, .zoom_btn:hover {
            background: rgba(255,255,255,1);
            transform: scale(1.05);
        }

        /* Адаптивность */
        /* Адаптивные стили */
        @media (max-width: 1400px) {
            .calculator-left {
                flex: 0 0 45%;
                min-width: 400px;
            }
            
            .calculator-right {
                flex: 1;
                min-width: 550px;
            }
        }

        @media (max-width: 1200px) {
            .calculator-row {
                gap: var(--gap-medium);
            }
            
            .calculator-left {
                flex: 0 0 50%;
                min-width: 350px;
            }
            
            .calculator-right {
                flex: 1;
                min-width: 500px;
            }
        }

        @media (max-width: 992px) {
            .container {
                padding: var(--gap-medium) var(--gap-small);
            }
            
            .calc-title {
                font-size: var(--font-size-4xl);
                margin-bottom: 40px;
            }
            
            .calculator-row {
                flex-direction: column;
                gap: var(--gap-medium);
                min-height: auto;
            }
            
            .calculator-left,
            .calculator-right {
                flex: 1;
                min-width: 100%;
                max-width: none;
            }
            
            .calculator-right {
                position: static;
                max-height: none;
                height: auto;
            }
            
            .images-block {
                min-height: 50vh;
                flex: none;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--gap-medium) var(--gap-small);
            }
            
            .calc-title {
                font-size: var(--font-size-3xl);
            }
            
            .calculator-left {
                padding: 35px;
            }
            
            .calculator-right-img-block {
                padding: var(--gap-medium);
            }
            
            .images-block {
                min-height: 350px;
                margin-top: var(--gap-small);
            }
            
            .total-data-row {
                flex-direction: column;
                gap: var(--gap-small);
            }
        }

        @media (max-width: 576px) {
            .calc-title {
                font-size: var(--font-size-2xl);
                margin-bottom: var(--gap-medium);
            }
            
            .calculator-left {
                padding: 25px;
            }
            
            .calculator-right-img-block {
                padding: var(--gap-small);
            }
            
            .type-row-raido-col {
                flex: 0 0 calc(33.333% - 8px);
                min-width: 80px;
            }
            
            .images-block {
                min-height: 300px;
                margin-top: var(--gap-small);
            }
            
            .calculator-row {
                gap: var(--gap-small);
            }
            
            /* Улучшение читаемости на маленьких экранах */
            .fz18, .text-lg { font-size: var(--font-size-base) !important; }
            .fz20, .text-xl { font-size: var(--font-size-lg) !important; }
            .fz25, .text-2xl { font-size: var(--font-size-xl) !important; }
        }

        /* Улучшения для интерактивных элементов */
        .btn {
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-small);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Улучшения для полей ввода */
        .select, input[type="range"] {
            transition: all 0.3s ease;
        }

        .select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(32, 181, 185, 0.1);
            border-color: var(--primary-color);
        }

        /* Улучшения для радио кнопок */
        .raido-image label {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .raido-image label:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .raido-image input:checked + label {
            border-color: var(--primary-color);
            background: rgba(32, 181, 185, 0.1);
        }

        /* Улучшения производительности */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .images-block canvas {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Полноширинный layout */
        .wrap-cont {
            width: 100vw;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .oh {
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <div class="wrap-cont oh">
        <div class="f2 title-f2 fz25 fw600 ttu lh mb-20 hide_cl show_992">Калькулятор
            <br> расчета навеса</div>
        
        <section class="calculator-row flex gap-40 mb-60 mb-20m">
            <div class="calculator-left">
                <div class="f2 title-f2 fz40 fw600 ttu lh mb-55 hide_992">Калькулятор
                    <br> расчета навеса</div>
                <div class="calculator-date">
                    <dl class="calculator-date-item calculator-date-item--type mb-55">
                        <dt class="name f2 fz18 fw600 ttu lh130 mb-30">форма кровли</dt>
                        <dd class="type-row-raido flex fxww gap-20">
                            <div class="type-row-raido-col">
                                <div class="raido-image">
                                    <input checked class="hide_cl" type="radio" name="type-karkas" id="type-karkas-var-1">
                                    <label for="type-karkas-var-1" class="flex aic jcc round-10 bg-f5 pointer" style="height: 100px;">
                                        <img src="https://lesnoeburo.ru/bitrix/templates/aspro_next_mn/images/images-calc/naves/1.svg" alt="Односкатный навес" style="width: 60px; height: 60px;">
                                    </label>
                                </div>
                            </div>
                            <div class="type-row-raido-col">
                                <div class="raido-image">
                                    <input class="hide_cl" type="radio" name="type-karkas" id="type-karkas-var-2">
                                    <label for="type-karkas-var-2" class="flex aic jcc round-10 bg-f5 pointer" style="height: 100px;">
                                        <img src="https://lesnoeburo.ru/bitrix/templates/aspro_next_mn/images/images-calc/naves/2.svg" alt="Двускатный навес" style="width: 60px; height: 60px;">
                                    </label>
                                </div>
                            </div>
                            <div class="type-row-raido-col">
                                <div class="raido-image">
                                    <input class="hide_cl" type="radio" name="type-karkas" id="type-karkas-var-3">
                                    <label for="type-karkas-var-3" class="flex aic jcc round-10 bg-f5 pointer" style="height: 100px;">
                                        <img src="https://lesnoeburo.ru/bitrix/templates/aspro_next_mn/images/images-calc/naves/3.svg" alt="Арочный навес" style="width: 60px; height: 60px;">
                                    </label>
                                </div>
                            </div>
                        </dd>
                    </dl>

                    <div class="calculator-list flex fxww gap-20 rgap-30 mb-50 mb-30m">
                        <dl>
                            <dt class="name f2 fz18 fw600 ttu lh130 mb-15">длина, м</dt>
                            <dd class="has-slider bg-f9 round-10 flex aic jcsb posr" data-min="1" data-max="20" data-value="11.0">
                                <div class="ot path fz17"><span>от</span>1м</div>
                                <div class="value fz22 fw600 center flex aic"><span>11.0</span>м</div>
                                <div class="do path fz17"><span>до</span>20м</div>
                                <div class="ui-container absolute w-full">
                                    <input type="range" class="slider" min="10" max="200" step="1" value="110" id="length">
                                </div>
                            </dd>
                        </dl>
                        <dl>
                            <dt class="name f2 fz18 fw600 ttu lh130 mb-15">ширина, м</dt>
                            <dd class="has-slider bg-f9 round-10 flex aic jcsb posr" data-min="1" data-max="10" data-value="6.0">
                                <div class="ot path fz17"><span>от</span>1м</div>
                                <div class="value fz22 fw600 center flex aic"><span>6.0</span>м</div>
                                <div class="do path fz17"><span>до</span>10м</div>
                                <div class="ui-container absolute w-full">
                                    <input type="range" class="slider" min="10" max="100" step="1" value="60" id="width">
                                </div>
                            </dd>
                        </dl>
                        <dl>
                            <dt class="name f2 fz18 fw600 ttu lh130 mb-15">высота столбов, м</dt>
                            <dd class="has-slider bg-f9 round-10 flex aic jcsb posr" data-min="1" data-max="4" data-value="3.0">
                                <div class="ot path fz17"><span>от</span>1м</div>
                                <div class="value fz22 fw600 center flex aic"><span>3.0</span>м</div>
                                <div class="do path fz17"><span>до</span>4м</div>
                                <div class="ui-container absolute w-full">
                                    <input type="range" class="slider" min="10" max="40" step="1" value="30" id="height">
                                </div>
                            </dd>
                        </dl>
                        <dl>
                            <dt class="name f2 fz18 fw600 ttu lh130 mb-15">высота скатов, м</dt>
                            <dd class="has-slider bg-f9 round-10 flex aic jcsb posr" data-min="1" data-max="3" data-value="2.0">
                                <div class="ot path fz17"><span>от</span>1м</div>
                                <div class="value fz22 fw600 center flex aic"><span>2.0</span>м</div>
                                <div class="do path fz17"><span>до</span>3м</div>
                                <div class="ui-container absolute w-full">
                                    <input type="range" class="slider" min="10" max="30" step="1" value="20" id="roofHeight">
                                </div>
                            </dd>
                        </dl>
                    </div>

                    <div class="calculator-hide-date mb-10 mb-0m">
                        <div class="triger-open flex aic jcsb f2 fz25 fw600 lh110 ttu pointer">уточнение дизайна
                            <div class="arrow flex aic jcc bg-red round-7"><img src="calc/images/images-calc/arrow-down-fff.svg" alt="arrow" style="width: 14px; height: 14px;"></div>
                        </div>
                        <div class="calculator-hide-info hide_cl pt-40">
                            <div class="label_cl fz18 fw600 mb-20">Столбы</div>
                            <div class="type-row-raido">
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input checked type="radio" name="type-stolbi" id="type-stolbi-var-1">
                                        <label for="type-stolbi-var-1">
                                            <img src="stolb/1.webp" alt="Столб 1" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-stolbi" id="type-stolbi-var-2">
                                        <label for="type-stolbi-var-2">
                                            <img src="stolb/2.webp" alt="Столб 2" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-stolbi" id="type-stolbi-var-3">
                                        <label for="type-stolbi-var-3">
                                            <img src="stolb/3.webp" alt="Столб 3" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-stolbi" id="type-stolbi-var-4">
                                        <label for="type-stolbi-var-4">
                                            <img src="stolb/4.webp" alt="Столб 4" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-stolbi" id="type-stolbi-var-5">
                                        <label for="type-stolbi-var-5">
                                            <img src="stolb/5.webp" alt="Столб 5" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-stolbi" id="type-stolbi-var-6">
                                        <label for="type-stolbi-var-6">
                                            <img src="stolb/6.webp" alt="Столб 6" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-stolbi" id="type-stolbi-var-7">
                                        <label for="type-stolbi-var-7">
                                            <img src="stolb/7.webp" alt="Столб 7" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-stolbi" id="type-stolbi-var-8">
                                        <label for="type-stolbi-var-8">
                                            <img src="stolb/8.webp" alt="Столб 8" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="label_cl fz18 fw600 mb-20">Раскосы</div>
                            <div class="type-row-raido">
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input checked type="radio" name="type-raskosi" id="type-raskosi-var-1">
                                        <label for="type-raskosi-var-1">
                                            <img src="raskos/1 (1).webp" alt="Раскос 1" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-raskosi" id="type-raskosi-var-2">
                                        <label for="type-raskosi-var-2">
                                            <img src="raskos/2 (1).webp" alt="Раскос 2" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-raskosi" id="type-raskosi-var-3">
                                        <label for="type-raskosi-var-3">
                                            <img src="raskos/3 (1).webp" alt="Раскос 3" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-raskosi" id="type-raskosi-var-4">
                                        <label for="type-raskosi-var-4">
                                            <img src="raskos/4 (1).webp" alt="Раскос 4" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-raskosi" id="type-raskosi-var-5">
                                        <label for="type-raskosi-var-5">
                                            <img src="raskos/5 (1).webp" alt="Раскос 5" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-raskosi" id="type-raskosi-var-6">
                                        <label for="type-raskosi-var-6">
                                            <img src="raskos/6 (1).webp" alt="Раскос 6" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-raskosi" id="type-raskosi-var-7">
                                        <label for="type-raskosi-var-7">
                                            <img src="raskos/7 (1).webp" alt="Раскос 7" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                                    </div>
                                </div>
                                <div class="type-row-raido-col">
                                    <div class="raido-image">
                                        <input type="radio" name="type-raskosi" id="type-raskosi-var-8">
                                        <label for="type-raskosi-var-8">
                                            <img src="raskos/8 (1).webp" alt="Раскос 8" style="width: 60px; height: 60px; object-fit: cover;">
                                        </label>
                            </div>
                        </div>
                    </div>

                            <div class="label_cl">Шаг столбов</div>
                            <dl>
                                <dt class="name">шаг столбов, м</dt>
                                <dd class="has-slider" data-min="1.0" data-max="3.5" data-value="2.5">
                                    <div class="ot">от<br>1.0м</div>
                                    <div class="value"><span>2.5</span>м</div>
                                    <div class="do">до<br>3.5м</div>
                                    <div class="ui-container">
                                        <input type="range" class="slider" min="10" max="35" step="1" value="25" id="columnStep">
                        </div>
                                </dd>
                            </dl>
                        </div>
                    </div>

                    <div class="calculator-hide-date mb-10 mb-0m">
                        <div class="triger-open flex aic jcsb f2 fz25 fw600 lh110 ttu pointer">уточнение параметров каркаса
                            <div class="arrow flex aic jcc bg-red round-7"><img src="calc/images/images-calc/arrow-down-fff.svg" alt="arrow" style="width: 14px; height: 14px;"></div>
                        </div>
                        <div class="calculator-hide-info hide_cl pt-40">
                            <!-- Блок Каркас -->
                            <div class="f2 fz16 fw600 lh140 ttu mb-30">Каркас</div>
                            <div class="field-row flex fxww mb-40">
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Материал каркаса</div>
                                    <select class="select" id="frameMaterial">
                                        <option value="pine">Сосна</option>
                                        <option value="larch">Лиственница</option>
                                        <option value="oak">Дуб</option>
                                        <option value="spruce">Ель</option>
                                    </select>
                                </div>
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Материал столбов</div>
                                    <select class="select" id="postMaterial">
                                        <option value="glued-100x100">Клееный брус 100×100×6000 мм</option>
                                        <option value="glued-200x200">Клееный брус 200×200×6000 мм</option>
                                        <option value="glued-240x140">Клееный брус 240×140 мм</option>
                                        <option value="glued-150x150">Клееный брус 150×150×6000 мм</option>
                                        <option value="planed-90x90">Строганый брус 90×90×6000 мм</option>
                                        <option value="planed-140x140">Строганый брус 140×140×6000 мм</option>
                                        <option value="planed-190x190">Строганый брус 190×190×6000 мм</option>
                                    </select>
                                </div>
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Материал ферм</div>
                                    <select class="select" id="trussMaterial">
                                        <option value="planed-45x190">Строганая доска 45×190 мм</option>
                                        <option value="planed-35x190">Строганая доска 35×190 мм</option>
                                        <option value="planed-150x50">Строганая доска 150×50 мм</option>
                                    </select>
                                </div>
                            </div>
                            <div class="field-row">
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Окрас</div>
                                    <select class="select" id="frameColoring">
                                        <option value="no-coloring">Без окраса</option>
                                        <option value="neomid">Neomid, пропитка</option>
                                        <option value="texturol-landscape">Текстурол Ландшафт, полуукрывная, полуматовая (светлые RAL, заводские цвета)</option>
                                        <option value="texturol-country">Текстурол Кантри, укрывная, полуматовая (любые цвета по RAL)</option>
                                        <option value="symphony-wood-guard">Symphony wood-guard, полуматовая</option>
                                        <option value="olsta">Olsta, матовая</option>
                                        <option value="tikkurila">Tikkurila</option>
                                    </select>
                                </div>
                            </div>
                            <div class="field-row">
                                <div class="field-col">
                                    <dl>
                                        <dt class="name">выпуск балки спереди, мм</dt>
                                        <dd class="has-slider" data-min="0" data-max="500" data-value="200">
                                            <div class="ot">от<br>0мм</div>
                                            <div class="value"><span>200</span>мм</div>
                                            <div class="do">до<br>500мм</div>
                                            <div class="ui-container">
                                                <input type="range" class="slider" min="0" max="500" step="10" value="200" id="frontBeamExtension">
                                            </div>
                                        </dd>
                                    </dl>
                                </div>
                                <div class="field-col">
                                    <dl>
                                        <dt class="name">выпуск балки сзади, мм</dt>
                                        <dd class="has-slider" data-min="0" data-max="500" data-value="200">
                                            <div class="ot">от<br>0мм</div>
                                            <div class="value"><span>200</span>мм</div>
                                            <div class="do">до<br>500мм</div>
                                            <div class="ui-container">
                                                <input type="range" class="slider" min="0" max="500" step="10" value="200" id="backBeamExtension">
                                            </div>
                                        </dd>
                                    </dl>
                                </div>
                            </div>

                            <!-- Блок Кровля -->
                            <div class="f2 fz16 fw600 lh140 ttu mb-30">Кровля</div>
                            <div class="field-row flex fxww mb-40">
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Материал кровли</div>
                                    <select class="select" id="roofingMaterial">
                                        <option value="no-roofing">Без кровли</option>
                                        <option value="shinglas-sonata">Гибкая черепица Shinglas Финская Соната</option>
                                        <option value="metal-grandline" selected>Металлочерепица Grand Line 0.45 мм + снегозадержатели</option>
                                        <option value="profiled-gl35r">Кровельный профнастил GL 35R</option>
                                        <option value="polycarbonate-8mm">Монолитный поликарбонат, 8 мм</option>
                                    </select>
                                </div>
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Цвет кровли</div>
                                    <select class="select" id="roofColor">
                                        <option value="amber">Янтарь</option>
                                        <option value="blue">Синий</option>
                                        <option value="green">Зеленый</option>
                                        <option value="red">Красный</option>
                                        <option value="gray">Серый</option>
                                    </select>
                                </div>
                            </div>
                            <div class="field-row">
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Водосточная система</div>
                                    <select class="select" id="gutterSystem">
                                        <option value="none">Без водосточной системы</option>
                                        <option value="docke-pvc">Docke ПВХ Premium 120/85 мм</option>
                                        <option value="metallprofil-grand">МеталлПрофиль GRANDSYSTEM 125/90 мм</option>
                                        <option value="pipe-funnel">Труба + воронка (цена за комплект, h=2000 )</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Блок Монтаж -->
                            <div class="f2 fz16 fw600 lh140 ttu mb-30">Монтаж</div>
                            <div class="field-row flex fxww mb-40">
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Требуется ли монтаж?</div>
                                    <select class="select" id="mountingRequired">
                                        <option value="yes">Да</option>
                                        <option value="no">Нет</option>
                                    </select>
                                </div>
                                <div class="field-col">
                                    <div class="label_cl fz18 fw600 mb-20">Крепление опор</div>
                                    <select class="select" id="foundationType">
                                        <option value="no-foundation">Без крепления</option>
                                        <option value="screw-pile-57-1500">Винтовые сваи, 57 мм × 1500 мм</option>
                                        <option value="screw-pile-89-2000">Винтовые сваи, 89 мм × 2000 мм</option>
                                        <option value="concrete-1500">Бетонирование, 1500 мм</option>
                                        <option value="plate-100-reinforced">Плита 100 мм, армированная</option>
                                        <option value="plate-150-reinforced">Плита 150 мм, армированная</option>
                                        <option value="adjustable-plates">Через регулируемые пластины</option>
                                        <option value="plate-sockets">Через стаканы к плите</option>
                                    </select>
                            </div>
                        </div>
                            <div class="field-row">
                                <div class="field-col" style="width: 100%;">
                                    <dl>
                                        <dt class="name">расстояние от МКАД, км</dt>
                                        <dd class="has-slider" data-min="1" data-max="100" data-value="10">
                                            <div class="ot">от<br>1км</div>
                                            <div class="value"><span>10</span>км</div>
                                            <div class="do">до<br>100км</div>
                                            <div class="ui-container">
                                                <input type="range" class="slider" min="1" max="100" step="1" value="10" id="distanceFromMKAD">
                                            </div>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="calculator-right">
                <div class="calculator-right-img-block">
                    <div class="path-top mb-30">
                        <div class="path-top-info flex aic jcsb mb-25">
                            <div class="price f2 fz30 fw600" id="totalPrice">256 000 ₽</div>
                            <a href="#smeta" class="link-360 fz15 pointer">Подробная смета</a>
                        </div>
                        
                        <div class="button-row flex gap-10">
                            <a href="#" class="btn btn-63 bg-red flex aic jcc fxg fz16 fw600 round-10" onclick="makeOrder()">Сделать заказ</a>
                            <a href="#" class="btn btn-63 bg-pink flex aic jcc fxg fz16 fw600 round-10" onclick="saveCalculation()">Сохранить расчет</a>
                        </div>
                    </div>
                    
                    <div class="images-block flex aic jcc posr bg-f9 round-10">
                        <canvas id="canopy3D" style="width: 100%; height: 100%;"></canvas>
                        <div class="images-button absolute">
                            <div class="link-360 flex aic pointer fz15">
                                <img src="calc/images/images-calc/360.svg" alt="360" style="width: 20px; height: 20px; margin-right: 5px;">
                                360°
                            </div>
                            <div class="save-btn flex aic jcc pointer round-5 bg-fff" style="width: 40px; height: 40px; margin-top: 10px;" title="Скачать" onclick="download3DImage()">
                                <img src="calc/images/images-calc/download.svg" alt="download" style="width: 20px; height: 20px;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="link-360">
                        🔄 Зажмите click для вращения, крутите scroll для вращения
                    </div>
                    <a href="#smeta" class="scroll-link">Подробная смета</a>
                </div>
            </div>
        </section>

        <section class="total-data">
            <div class="total-data-row">
                <div class="total-data-col">
                    <div class="total-data-item">
                        Площадь навеса
                        <div class="value" id="areaDisplay">121м²</div>
                    </div>
                    <div class="total-data-item">
                        Стоимость м²
                        <div class="value" id="pricePerSquare">2 115 ₽</div>
                    </div>
                    <div class="total-data-item">
                        Стоимость материалов
                        <div class="value" id="materialsCost">180 000 ₽</div>
                    </div>
                </div>
                <div class="total-data-col">
                    <div class="total-data-item">
                        Стоимость производства
                        <div class="value" id="productionCost">54 000 ₽</div>
                    </div>
                    <div class="total-data-item">
                        Расходные материалы
                        <div class="value" id="consumablesCost">18 000 ₽</div>
                    </div>
                    <div class="total-data-item">
                        Стоимость монтажа
                        <div class="value" id="mountingCost">36 000 ₽</div>
                    </div>
                </div>
                <div class="total-data-col">
                    <div class="total-data-item">
                        Срок производства
                        <div class="value" id="productionTime">8 дней</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="specification" id="smeta">
            <h2>спецификация навеса</h2>
            <div class="mb-30">
                <dl>
                    <dt class="flex aic f2 pointer">
                        <div class="num">01.</div>
                        <div class="name">общие параметры</div>
                        <div class="arrow">▼</div>
                    </dt>
                    <dd>
                        <ul>
                            <li>
                                <div class="num">1.1</div>
                                <div class="parameter">Тип навеса</div>
                                <div class="value" id="specRoofType">Односкатный</div>
                            </li>
                            <li>
                                <div class="num">1.2</div>
                                <div class="parameter">Материал каркаса</div>
                                <div class="value" id="specFrameMaterial">Сосна</div>
                            </li>
                            <li>
                                <div class="num">1.3</div>
                                <div class="parameter">Материал кровли</div>
                                <div class="value" id="specRoofingMaterial">Поликарбонат</div>
                            </li>
                            <li>
                                <div class="num">1.4</div>
                                <div class="parameter">Цвет кровли</div>
                                <div class="value" id="specRoofColor">Янтарь</div>
                            </li>
                            <li>
                                <div class="num">1.5</div>
                                <div class="parameter">Площадь</div>
                                <div class="value" id="specArea">121м²</div>
                            </li>
                            <li>
                                <div class="num">1.6</div>
                                <div class="parameter">Ширина по осям</div>
                                <div class="value" id="specWidth">11 000 мм</div>
                            </li>
                            <li>
                                <div class="num">1.7</div>
                                <div class="parameter">Длина по ригелю</div>
                                <div class="value" id="specLength">11 000 мм</div>
                            </li>
                            <li>
                                <div class="num">1.8</div>
                                <div class="parameter">Высота столбов</div>
                                <div class="value" id="specHeight">11 000 мм</div>
                            </li>
                            <li>
                                <div class="num">1.9</div>
                                <div class="parameter">Высота скатов</div>
                                <div class="value" id="specRoofHeight">11 000 мм</div>
                            </li>
                            <li>
                                <div class="num">1.10</div>
                                <div class="parameter">Шаг столбов</div>
                                <div class="value" id="specBeamStep">1 200 мм</div>
                            </li>
                        </ul>
                    </dd>
                </dl>
                <dl>
                    <dt class="flex aic f2 pointer">
                        <div class="num">02.</div>
                        <div class="name">столбы</div>
                        <div class="arrow">▼</div>
                    </dt>
                    <dd>
                        <ul>
                            <li>
                                <div class="num">2.1</div>
                                <div class="parameter">Количество столбов</div>
                                <div class="value" id="specPosts">20 шт.</div>
                            </li>
                            <li>
                                <div class="num">2.2</div>
                                <div class="parameter">Тип столбов</div>
                                <div class="value" id="specPostType">Стандартный</div>
                            </li>
                            <li>
                                <div class="num">2.3</div>
                                <div class="parameter">Материал столбов</div>
                                <div class="value" id="specPostMaterial">Сосна</div>
                            </li>
                            <li>
                                <div class="num">2.4</div>
                                <div class="parameter">Высота столбов слева</div>
                                <div class="value" id="specHeightLeft">11 000 мм</div>
                            </li>
                            <li>
                                <div class="num">2.5</div>
                                <div class="parameter">Высота столбов справа</div>
                                <div class="value" id="specHeightRight">11 000 мм</div>
                            </li>
                            <li>
                                <div class="num">2.6</div>
                                <div class="parameter">Сечение столбов</div>
                                <div class="value" id="specPostSection">150 x 150 мм</div>
                            </li>
                        </ul>
                    </dd>
                </dl>
                <dl>
                    <dt class="flex aic f2 pointer">
                        <div class="num">03.</div>
                        <div class="name">Фермы</div>
                        <div class="arrow">▼</div>
                    </dt>
                    <dd>
                        <ul>
                            <li>
                                <div class="num">3.1</div>
                                <div class="parameter">Количество ферм</div>
                                <div class="value" id="specFarms">10 шт.</div>
                            </li>
                            <li>
                                <div class="num">3.2</div>
                                <div class="parameter">Материал рамы</div>
                                <div class="value">Профильная труба 40 x 40 x 2 мм</div>
                            </li>
                            <li>
                                <div class="num">3.3</div>
                                <div class="parameter">Материал обрешетки</div>
                                <div class="value">Профильная труба 40 x 20 x 1.5 мм</div>
                            </li>
                            <li>
                                <div class="num">3.4</div>
                                <div class="parameter">Длина фермы</div>
                                <div class="value" id="specFarmLength">10 880 мм</div>
                            </li>
                            <li>
                                <div class="num">3.5</div>
                                <div class="parameter">Шаг ферм</div>
                                <div class="value" id="specTrussSpacing">1 200 мм</div>
                            </li>
                        </ul>
                    </dd>
                </dl>
                <dl>
                    <dt class="flex aic f2 pointer">
                        <div class="num">04.</div>
                        <div class="name">Раскосы</div>
                        <div class="arrow">▼</div>
                    </dt>
                    <dd>
                        <ul>
                            <li>
                                <div class="num">4.1</div>
                                <div class="parameter">Количество раскосов</div>
                                <div class="value" id="specBraces">40 шт.</div>
                            </li>
                            <li>
                                <div class="num">4.2</div>
                                <div class="parameter">Тип раскосов</div>
                                <div class="value" id="specBraceType">Стандартный</div>
                            </li>
                            <li>
                                <div class="num">4.3</div>
                                <div class="parameter">Материал раскосов</div>
                                <div class="value" id="specBraceMaterial">Сосна</div>
                            </li>
                            <li>
                                <div class="num">4.4</div>
                                <div class="parameter">Сечение раскосов</div>
                                <div class="value">50 x 100 мм</div>
                            </li>
                            <li>
                                <div class="num">4.5</div>
                                <div class="parameter">Длина раскосов</div>
                                <div class="value">1 500 мм</div>
                            </li>
                        </ul>
                    </dd>
                </dl>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        let priceMap = null;
        let currentPostSpacing = 2.5; // Текущий шаг столбов в метрах

        // Инициализация ползунков
        function initSliders() {
            const sliders = document.querySelectorAll('.slider');
            console.log('Найдено слайдеров:', sliders.length);
            
            sliders.forEach(slider => {
                console.log('Инициализация слайдера:', slider.id, 'min:', slider.min, 'max:', slider.max, 'value:', slider.value);
                
                slider.addEventListener('input', function() {
                    const container = this.closest('.has-slider');
                    const valueSpan = container.querySelector('.value span');
                    
                    // Специальная обработка для бегунков выпуска балок (отображаем в мм без точки)
                    if (this.id === 'frontBeamExtension' || this.id === 'backBeamExtension') {
                        if (valueSpan) {
                            valueSpan.textContent = this.value; // Отображаем как есть (в мм)
                        }
                    } else {
                        // Для остальных бегунков - стандартная обработка
                        const value = (this.value / 10).toFixed(1); // Конвертируем в десятичные с одним знаком после запятой
                    if (valueSpan) {
                        valueSpan.textContent = value;
                    }
                    }
                    
                    // Специальная обработка для бегунка шага столбов
                    if (this.id === 'columnStep') {
                        const value = (this.value / 10).toFixed(1);
                        currentPostSpacing = parseFloat(value);
                        // Перерисовываем 3D модель с новым шагом столбов
                        update3DModel();
                    }
                    
                    calculateTotal();
                });
            });
        }

        // Обработка раскрытия секций
        function initToggleSection() {
            const triggers = document.querySelectorAll('.triger-open');
            
            triggers.forEach(trigger => {
                trigger.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    content.classList.toggle('active');
                    
                    const arrow = this.querySelector('.arrow');
                    if (this.classList.contains('active')) {
                        arrow.textContent = '▲';
                    } else {
                        arrow.textContent = '▼';
                    }
                });
            });
        }

        // Инициализация спецификации
        function initSpecification() {
            const specItems = document.querySelectorAll('.specification dt');
            specItems.forEach(item => {
                item.addEventListener('click', function() {
                    const dd = this.nextElementSibling;
                    this.classList.toggle('active');
                    dd.classList.toggle('active');
                });
            });
        }

        // Загрузка стандартного файла с ценами
        async function loadDefaultExcel() {
            try {
                // Используем цены по умолчанию
                priceMap = {
                    'beam_m': { name: 'Балка (м)', unit: 'м', price: 800, currency: 'RUB' },
                    'beam_m_larch': { name: 'Балка лиственница (м)', unit: 'м', price: 1200, currency: 'RUB' },
                    'beam_m_oak': { name: 'Балка дуб (м)', unit: 'м', price: 2000, currency: 'RUB' },
                    'beam_m_spruce': { name: 'Балка ель (м)', unit: 'м', price: 600, currency: 'RUB' },
                    'post_piece': { name: 'Стойка', unit: 'шт', price: 2000, currency: 'RUB' },
                    'post_piece_larch': { name: 'Стойка лиственница', unit: 'шт', price: 3000, currency: 'RUB' },
                    'post_piece_oak': { name: 'Стойка дуб', unit: 'шт', price: 5000, currency: 'RUB' },
                    'post_piece_spruce': { name: 'Стойка ель', unit: 'шт', price: 1500, currency: 'RUB' },
                    'roofing_polycarbonate': { name: 'Поликарбонат (м²)', unit: 'м²', price: 1200, currency: 'RUB' },
                    'roofing_metal': { name: 'Металлочерепица (м²)', unit: 'м²', price: 1500, currency: 'RUB' },
                    'roofing_ondulin': { name: 'Ондулин (м²)', unit: 'м²', price: 800, currency: 'RUB' },
                    'roofing_wood': { name: 'Деревянная кровля (м²)', unit: 'м²', price: 2500, currency: 'RUB' },
                    'roofing_slate': { name: 'Шифер (м²)', unit: 'м²', price: 600, currency: 'RUB' },
                    'fasteners_set': { name: 'Крепеж', unit: 'компл', price: 5000, currency: 'RUB' },
                    'production_coefficient': { name: 'Коэффициент производства', unit: 'шт', price: 0.3, currency: 'RUB' },
                    'mounting_yes': { name: 'Монтаж', unit: 'шт', price: 0.2, currency: 'RUB' },
                    'mounting_no': { name: 'Без монтажа', unit: 'шт', price: 0, currency: 'RUB' }
                };
                console.log('Цены загружены:', priceMap);
            } catch (error) {
                console.error('Ошибка загрузки файла с ценами:', error);
            }
        }

        // Расчет общей стоимости
        function calculateTotal() {
            if (!priceMap) return;

            // Получаем основные размеры (конвертируем из слайдеров)
            const length = parseFloat(document.getElementById('length').value) / 10;
            const width = parseFloat(document.getElementById('width').value) / 10;
            const height = parseFloat(document.getElementById('height').value) / 10;
            const roofHeight = parseFloat(document.getElementById('roofHeight').value) / 10;
            
            // Получаем параметры формы кровли
            const roofType = getSelectedRadioValue('type-karkas') || 'var-1';
            
            // Получаем параметры дизайна
            const postType = getSelectedRadioValue('type-stolbi') || 'var-1';
            const braceType = getSelectedRadioValue('type-raskosi') || 'var-1';
            
            // Получаем параметры каркаса
            const frameMaterial = document.getElementById('frameMaterial')?.value || 'pine';
            const postMaterial = document.getElementById('postMaterial')?.value || 'glued-150x150';
            const roofingMaterial = document.getElementById('roofingMaterial')?.value || 'metal-grandline';
            const roofColor = document.getElementById('roofColor')?.value || 'amber';
            const mountingRequired = document.getElementById('mountingRequired')?.value || 'yes';
            
            
            // Расчет площади и количества материалов
            const area = length * width;
            const postSpacing = currentPostSpacing; // Используем динамический шаг столбов
            const postsAlongLength = Math.ceil(length / postSpacing) + 1;
            const postCount = postsAlongLength * 2; // Два ряда по краям длины (левая и правая стороны)
            const beamLength = length * 2; // Балки по длине (левая и правая)
            const braceCount = postCount * 2;
            
            let materialsCost = 0;
            
            // Балки в зависимости от материала
            const beamKey = `beam_m_${frameMaterial}`;
            const beamPrice = priceMap[beamKey]?.price || 800;
            materialsCost += beamLength * beamPrice;
            
            // Стойки в зависимости от материала
            const postKey = `post_piece_${frameMaterial}`;
            const postPrice = priceMap[postKey]?.price || 2000;
            materialsCost += postCount * postPrice;
            
            // Кровельный материал
            const roofingKey = `roofing_${roofingMaterial}`;
            const roofingPrice = priceMap[roofingKey]?.price || 1200;
            materialsCost += area * roofingPrice;
            
            // Крепеж
            const fastenersPrice = priceMap['fasteners_set']?.price || 5000;
            materialsCost += fastenersPrice;
            
            // Коэффициент производства
            const productionCoeff = priceMap['production_coefficient']?.price || 0.3;
            const productionCost = materialsCost * productionCoeff;
            
            // Монтаж
            let mountingCost = 0;
            if (mountingRequired === 'yes') {
                const mountingCoeff = priceMap['mounting_yes']?.price || 0.2;
                mountingCost = materialsCost * mountingCoeff;
            }
            
            const totalCost = materialsCost + productionCost + mountingCost;
            
            // Обновляем отображение
            document.getElementById('totalPrice').textContent = formatMoney(totalCost);
            updateTotalData(area, totalCost, materialsCost, productionCost, mountingCost);
            updateSpecification();
            update3DModel();
        }
        
        // Функция для получения выбранного значения radio button
        function getSelectedRadioValue(name) {
            const selected = document.querySelector(`input[name="${name}"]:checked`);
            return selected ? selected.id.split('-').pop() : null;
        }

        // Обновление итоговых данных
        function updateTotalData(area, totalCost, materialsCost, productionCost, mountingCost) {
            document.getElementById('areaDisplay').textContent = area + 'м²';
            document.getElementById('pricePerSquare').textContent = formatMoney(totalCost / area);
            document.getElementById('materialsCost').textContent = formatMoney(materialsCost);
            document.getElementById('productionCost').textContent = formatMoney(productionCost);
            document.getElementById('consumablesCost').textContent = formatMoney(materialsCost * 0.1);
            document.getElementById('mountingCost').textContent = formatMoney(mountingCost);
        }

        // Форматирование денег
        function formatMoney(amount) {
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Обновление спецификации
        function updateSpecification() {
            const length = parseFloat(document.getElementById('length').value) / 10;
            const width = parseFloat(document.getElementById('width').value) / 10;
            const height = parseFloat(document.getElementById('height').value) / 10;
            const roofHeight = parseFloat(document.getElementById('roofHeight').value) / 10;
            
            // Получаем значения выпуска балок
            const frontBeamExtension = parseFloat(document.getElementById('frontBeamExtension')?.value || 200) / 1000; // в метрах
            const backBeamExtension = parseFloat(document.getElementById('backBeamExtension')?.value || 200) / 1000; // в метрах
            
            const roofType = getSelectedRadioValue('type-karkas') || 'var-1';
            const postType = getSelectedRadioValue('type-stolbi') || 'var-1';
            const braceType = getSelectedRadioValue('type-raskosi') || 'var-1';
            const frameMaterial = document.getElementById('frameMaterial')?.value || 'pine';
            const roofingMaterial = document.getElementById('roofingMaterial')?.value || 'metal-grandline';
            const roofColor = document.getElementById('roofColor')?.value || 'amber';
            
            const area = length * width;
            const postSpacing = currentPostSpacing; // Используем динамический шаг столбов
            const postsAlongLength = Math.ceil(length / postSpacing) + 1;
            const postCount = postsAlongLength * 2; // Два ряда по краям длины (левая и правая стороны)
            const farmCount = Math.ceil(postCount / 2); // Количество ферм = количество столбов / 2
            const braceCount = postCount * 2;
            
            // Словари для преобразования значений в читаемые названия
            const materialNames = {
                'pine': 'Сосна',
                'larch': 'Лиственница', 
                'oak': 'Дуб',
                'spruce': 'Ель',
                'shinglas-sonata': 'Гибкая черепица Shinglas Финская Соната',
                'metal-grandline': 'Металлочерепица Grand Line 0.45 мм + снегозадержатели',
                'profiled-gl35r': 'Кровельный профнастил GL 35R',
                'polycarbonate-8mm': 'Монолитный поликарбонат, 8 мм',
                'amber': 'Янтарь',
                'blue': 'Синий',
                'green': 'Зеленый',
                'red': 'Красный',
                'gray': 'Серый',
                'none': 'Без водосточной системы',
                'docke-pvc': 'Docke ПВХ Premium 120/85 мм',
                'metallprofil-grand': 'МеталлПрофиль GRANDSYSTEM 125/90 мм',
                'pipe-funnel': 'Труба + воронка (цена за комплект, h=2000 )',
                'var-1': 'Односкатный',
                'var-2': 'Двускатный',
                'var-3': 'Арочный'
            };

            const typeNames = {
                'var-1': 'Стандартный',
                'var-2': 'Усиленный',
                'var-3': 'Декоративный'
            };
            
            const postSectionNames = {
                'glued-100x100': '100×100 мм',
                'glued-200x200': '200×200 мм',
                'glued-300x300': '300×300 мм',
                'glued-240x140': '240×140 мм',
                'glued-140x340': '140×340 мм',
                'glued-240x240': '240×240 мм',
                'glued-100x150': '100×150 мм',
                'glued-150x150': '150×150 мм',
                'planed-90x90': '90×90 мм',
                'planed-140x140': '140×140 мм',
                'planed-190x190': '190×190 мм',
                'planed-240x240': '240×240 мм',
                'glued-200x200-larch': '200×200 мм',
                'glued-250x150-larch': '250×150 мм',
                'glued-250x150-larch-8m': '250×150 мм'
            };
            
            const postMaterialNames = {
                'glued-100x100': 'Клееный брус',
                'glued-200x200': 'Клееный брус',
                'glued-300x300': 'Клееный брус',
                'glued-240x140': 'Клееный брус',
                'glued-140x340': 'Клееный брус',
                'glued-240x240': 'Клееный брус',
                'glued-100x150': 'Клееный брус',
                'glued-150x150': 'Клееный брус',
                'planed-90x90': 'Строганый брус',
                'planed-140x140': 'Строганый брус',
                'planed-190x190': 'Строганый брус',
                'planed-240x240': 'Строганый брус',
                'glued-200x200-larch': 'Клееный брус (лиственница)',
                'glued-250x150-larch': 'Клееный брус (лиственница)',
                'glued-250x150-larch-8m': 'Клееный брус (лиственница)'
            };
            
            // Обновляем значения в спецификации - общие параметры
            document.getElementById('specArea').textContent = area + 'м²';
            document.getElementById('specWidth').textContent = (width * 1000) + ' мм';
            // Длина по ригелю = длина навеса + выпуск балки спереди + выпуск балки сзади
            const totalLength = length + frontBeamExtension + backBeamExtension;
            document.getElementById('specLength').textContent = (totalLength * 1000) + ' мм';
            document.getElementById('specHeight').textContent = (height * 1000) + ' мм';
            document.getElementById('specRoofHeight').textContent = (roofHeight * 1000) + ' мм';
            document.getElementById('specBeamStep').textContent = (postSpacing * 1000) + ' мм';
            document.getElementById('specRoofType').textContent = materialNames[roofType] || roofType;
            document.getElementById('specFrameMaterial').textContent = materialNames[frameMaterial] || frameMaterial;
            document.getElementById('specRoofingMaterial').textContent = materialNames[roofingMaterial] || roofingMaterial;
            document.getElementById('specRoofColor').textContent = materialNames[roofColor] || roofColor;

            // Обновляем значения в спецификации - столбы
            document.getElementById('specPosts').textContent = postCount + ' шт.';
            document.getElementById('specPostType').textContent = typeNames[postType] || 'Стандартный';
            document.getElementById('specPostMaterial').textContent = materialNames[frameMaterial] || frameMaterial;
            
            // Обновляем сечение столбов из выбранного материала столбов
            const postSectionValue = postSectionNames[postMaterial] || '150×150 мм';
            document.getElementById('specPostSection').textContent = postSectionValue;
            
            document.getElementById('specHeightLeft').textContent = (height * 1000) + ' мм';
            document.getElementById('specHeightRight').textContent = (height * 1000) + ' мм';

            // Обновляем значения в спецификации - фермы
            const trussCount = Math.ceil(postCount / 2); // Количество ферм = количество столбов / 2
            const trussSpacing = trussCount > 1 ? (length * 1000) / (trussCount - 1) : (length * 1000);
            
            // Отладочная информация
            console.log('Расчет ферм:', {
                postCount: postCount,
                trussCount: trussCount,
                trussSpacing: Math.round(trussSpacing),
                length: length * 1000
            });
            
            document.getElementById('specFarms').textContent = trussCount + ' шт.';
            document.getElementById('specFarmLength').textContent = (width * 1000 - 120) + ' мм';
            document.getElementById('specTrussSpacing').textContent = Math.round(trussSpacing) + ' мм';

            // Обновляем значения в спецификации - раскосы
            document.getElementById('specBraces').textContent = braceCount + ' шт.';
            document.getElementById('specBraceType').textContent = typeNames[braceType] || 'Стандартный';
            document.getElementById('specBraceMaterial').textContent = materialNames[frameMaterial] || frameMaterial;
        }

        // Функции заказа и сохранения
        function makeOrder() {
            alert('Функция заказа будет реализована');
        }

        function saveCalculation() {
            alert('Функция сохранения будет реализована');
        }
        
        // Функция для получения выбранного значения радиокнопки
        function getSelectedRadioValue(name) {
            const selected = document.querySelector(`input[name="${name}"]:checked`);
            if (selected) {
                // Извлекаем var-X из ID типа "type-stolbi-var-1"
                const match = selected.id.match(/var-(\d+)$/);
                return match ? `var-${match[1]}` : 'var-1';
            }
            return 'var-1';
        }

        // Инициализация селектов
        function initSelects() {
            const selects = document.querySelectorAll('.select');
            selects.forEach(select => {
                select.addEventListener('change', function() {
                    console.log('Select changed:', this.id, 'value:', this.value);
                    calculateTotal();
                    // Обновляем 3D модель при изменении материалов
                    if (this.id === 'roofingMaterial' || this.id === 'roofColor' || this.id === 'postMaterial' || this.id === 'trussMaterial') {
                        update3DModel();
                    }
                });
            });
        }
        
        // Инициализация radio button
        function initRadioButtons() {
            const radioGroups = ['type-karkas', 'type-stolbi', 'type-raskosi'];
            radioGroups.forEach(groupName => {
                const radios = document.querySelectorAll(`input[name="${groupName}"]`);
                radios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        calculateTotal();
                        // Обновляем 3D модель при изменении типа элементов
                        update3DModel();
                    });
                });
            });
        }

        // 3D визуализация с Three.js
        let scene, camera, renderer, controls;
        let canopyGroup;

        function init3DScene() {
            const canvas = document.getElementById('canopy3D');
            const container = canvas.parentElement;
            
            // Создание сцены
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xffffff); // Белый фон как на изображении
            
            // Создание камеры
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(15, 10, 15);
            
            // Создание рендерера
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Создание контролов для вращения
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.enableZoom = true;
            controls.enablePan = false;
            
            // Улучшенное освещение для реалистичного вида
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.3); // Мягкий рассеянный свет
            scene.add(ambientLight);
            
            // Основной источник света (имитация солнца)
            const sunLight = new THREE.DirectionalLight(0xffffff, 1.0);
            sunLight.position.set(20, 25, 15);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            sunLight.shadow.camera.near = 0.5;
            sunLight.shadow.camera.far = 50;
            sunLight.shadow.camera.left = -25;
            sunLight.shadow.camera.right = 25;
            sunLight.shadow.camera.top = 25;
            sunLight.shadow.camera.bottom = -25;
            sunLight.shadow.bias = -0.0001;
            scene.add(sunLight);
            
            // Заполняющий свет для мягких теней
            const fillLight = new THREE.DirectionalLight(0x87CEEB, 0.4); // Небесно-голубой
            fillLight.position.set(-15, 15, -10);
            scene.add(fillLight);
            
            // Дополнительный точечный источник для подсветки деталей
            const pointLight = new THREE.PointLight(0xffffff, 0.5, 30);
            pointLight.position.set(0, 15, 0);
            scene.add(pointLight);
            
            // Создание группы для навеса
            canopyGroup = new THREE.Group();
            scene.add(canopyGroup);
            
            // Создание навеса
            createCanopy();
            
            // Анимационный цикл
            animate();
            
            // Обработка изменения размера окна
            window.addEventListener('resize', onWindowResize);
        }
        
        function createCanopy() {
            // Очистка предыдущего навеса
            canopyGroup.clear();
            
            // Получение параметров (конвертируем из слайдеров)
            const length = parseFloat(document.getElementById('length').value) / 10;
            const width = parseFloat(document.getElementById('width').value) / 10;
            const height = parseFloat(document.getElementById('height').value) / 10;
            const roofHeight = parseFloat(document.getElementById('roofHeight').value) / 10;
            
            // Получение значений выпуска балок
            const frontBeamExtension = parseFloat(document.getElementById('frontBeamExtension')?.value || 200) / 1000; // в метрах
            const backBeamExtension = parseFloat(document.getElementById('backBeamExtension')?.value || 200) / 1000; // в метрах
            
            // Получение цвета кровли и типа каркаса
            const roofColor = document.getElementById('roofColor')?.value || 'amber';
            const roofType = getSelectedRadioValue('type-karkas') || 'var-1';
            const postType = getSelectedRadioValue('type-stolbi') || 'var-1';
            const braceType = getSelectedRadioValue('type-raskosi') || 'var-1';
            const postMaterial = document.getElementById('postMaterial')?.value || 'glued-150x150';
            const trussMaterial = document.getElementById('trussMaterial')?.value || 'planed-45x190';
            
            // Получаем размеры для отладки
            const postDimensions = getPostDimensions(postMaterial);
            const trussDimensions = getTrussDimensions(trussMaterial);
            
            // Отладочная информация
            console.log('3D Model Update:', {
                roofType: roofType,
                postType: postType,
                braceType: braceType,
                roofColor: roofColor,
                postMaterial: postMaterial,
                trussMaterial: trussMaterial,
                postDimensions: `${postDimensions.width * 1000}×${postDimensions.height * 1000} мм`,
                beamDimensions: `${postDimensions.width * 1000}×${postDimensions.height * 1000} мм`, // Балки = столбы
                trussDimensions: `${trussDimensions.width * 1000}×${trussDimensions.height * 1000} мм`
            });
            
            // Улучшенные материалы
            const woodMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xDEB887, // Более реалистичный цвет дерева
                transparent: false
            });
            
            // Добавляем текстуру дерева (процедурная)
            const woodTexture = new THREE.CanvasTexture(createWoodTexture());
            woodTexture.wrapS = THREE.RepeatWrapping;
            woodTexture.wrapT = THREE.RepeatWrapping;
            woodTexture.repeat.set(4, 4);
            woodMaterial.map = woodTexture;
            
            // Функция для получения цвета кровли
            function getRoofColor(colorName) {
                const roofColors = {
                    'amber': 0xFFBF00,    // Янтарь
                    'blue': 0x1E90FF,     // Синий
                    'green': 0x228B22,    // Зеленый
                    'red': 0xDC143C,      // Красный
                    'gray': 0x708090      // Серый
                };
                return roofColors[colorName] || roofColors['amber'];
            }
            
            const roofingMaterial = new THREE.MeshPhongMaterial({ 
                color: getRoofColor(roofColor),
                shininess: 80,
                specular: 0x444444,
                transparent: true,
                opacity: 0.95
            });
            
            const metalMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x555555, // Металлические крепления
                metalness: 0.8,
                roughness: 0.2
            });
            
            // 1. Создание деревянных столбов
            createPosts(length, width, height, woodMaterial, metalMaterial, postType, postMaterial);
            
            // 2. Создание продольных балок по столбам
            createLongitudinalBeams(length, width, height, woodMaterial, frontBeamExtension, backBeamExtension, postMaterial);
            
            // 3. Создание ферм в зависимости от типа каркаса
            createTrusses(length, width, height, roofHeight, woodMaterial, roofType, braceType, postMaterial, trussMaterial);
            
            // 4. Создание кровельного покрытия
            createRoofCovering(length, width, height, roofHeight, roofingMaterial, frontBeamExtension, backBeamExtension, roofType);
            
            // Создание земли
            createGround();
        }
        
        // Функция создания процедурной текстуры дерева
        function createWoodTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 256;
            const ctx = canvas.getContext('2d');
            
            // Базовый цвет дерева
            ctx.fillStyle = '#DEB887';
            ctx.fillRect(0, 0, 256, 256);
            
            // Добавляем волокна дерева
            for (let i = 0; i < 20; i++) {
                ctx.strokeStyle = `rgba(139, 69, 19, ${0.1 + Math.random() * 0.2})`;
                ctx.lineWidth = 1 + Math.random() * 2;
                ctx.beginPath();
                ctx.moveTo(0, Math.random() * 256);
                ctx.lineTo(256, Math.random() * 256);
                ctx.stroke();
            }
            
            // Добавляем годичные кольца
            for (let i = 0; i < 8; i++) {
                ctx.strokeStyle = `rgba(160, 82, 45, ${0.15 + Math.random() * 0.1})`;
                ctx.lineWidth = 0.5 + Math.random();
                ctx.beginPath();
                const y = (i + 1) * 32 + Math.random() * 16 - 8;
                ctx.moveTo(0, y);
                for (let x = 0; x <= 256; x += 8) {
                    ctx.lineTo(x, y + Math.sin(x * 0.02) * 3);
                }
                ctx.stroke();
            }
            
            return canvas;
        }
        
        // Функция для извлечения размеров столба из материала
        function getPostDimensions(postMaterial) {
            // Извлекаем размеры из названия материала (например, "100x100", "140x240")
            const match = postMaterial.match(/(\d+)x(\d+)/);
            if (match) {
                const width = parseInt(match[1]) / 1000; // Конвертируем мм в метры
                const height = parseInt(match[2]) / 1000;
                return { width: width, height: height };
            }
            // По умолчанию 150x150 мм
            return { width: 0.15, height: 0.15 };
        }
        
        // Функция для извлечения размеров ферм из материала
        function getTrussDimensions(trussMaterial) {
            // Извлекаем размеры из названия материала (например, "45x190", "50x150")
            const match = trussMaterial.match(/(\d+)x(\d+)/);
            if (match) {
                const width = parseInt(match[1]) / 1000; // Конвертируем мм в метры
                const height = parseInt(match[2]) / 1000;
                return { width: width, height: height };
            }
            // По умолчанию 45x190 мм
            return { width: 0.045, height: 0.19 };
        }
        
        // Тестовая функция для проверки всех материалов (можно удалить после проверки)
        function testAllMaterials() {
            const postMaterials = [
                'glued-100x100', 'glued-200x200', 'glued-240x140', 'glued-150x150',
                'planed-90x90', 'planed-140x140', 'planed-190x190'
            ];
            
            const trussMaterials = [
                'planed-45x190', 'planed-35x190', 'planed-150x50'
            ];
            
            console.log('Тест всех материалов столбов:');
            postMaterials.forEach(material => {
                const dimensions = getPostDimensions(material);
                console.log(`${material}: ${dimensions.width * 1000}×${dimensions.height * 1000} мм`);
            });
            
            console.log('\nТест всех материалов ферм:');
            trussMaterials.forEach(material => {
                const dimensions = getTrussDimensions(material);
                console.log(`${material}: ${dimensions.width * 1000}×${dimensions.height * 1000} мм`);
            });
        }
        
        // Функция создания деревянных столбов
        function createPosts(length, width, height, woodMaterial, metalMaterial, postType = 'var-1', postMaterial = 'glued-150x150') {
            const postSpacing = currentPostSpacing; // Используем динамический шаг столбов
            const postsAlongLength = Math.ceil(length / postSpacing) + 1;
            
            // Получаем размеры столба из выбранного материала
            const postDimensions = getPostDimensions(postMaterial);
            
            // Выбираем геометрию столба в зависимости от типа (соответствует изображениям stolb/1.webp - stolb/8.webp)
            let postGeometry;
            switch(postType) {
                case 'var-1': // Столб 1 - Квадратный брус (размеры из материала)
                    postGeometry = new THREE.BoxGeometry(postDimensions.width, height, postDimensions.height);
                    break;
                case 'var-2': // Столб 2 - Круглый столб (диаметр из материала)
                    const radius = Math.min(postDimensions.width, postDimensions.height) / 2;
                    postGeometry = new THREE.CylinderGeometry(radius, radius, height, 16);
                    break;
                case 'var-3': // Столб 3 - Прямоугольный брус (размеры из материала)
                    postGeometry = new THREE.BoxGeometry(postDimensions.width, height, postDimensions.height);
                    break;
                case 'var-4': // Столб 4 - Двутавровый профиль (размеры из материала)
                    postGeometry = new THREE.BoxGeometry(postDimensions.width, height, postDimensions.height * 0.6);
                    break;
                case 'var-5': // Столб 5 - Шестигранный столб (размер из материала)
                    const hexRadius = Math.min(postDimensions.width, postDimensions.height) / 2;
                    postGeometry = new THREE.CylinderGeometry(hexRadius, hexRadius, height, 6);
                    break;
                case 'var-6': // Столб 6 - Восьмигранный столб (размер из материала)
                    const octRadius = Math.min(postDimensions.width, postDimensions.height) / 2;
                    postGeometry = new THREE.CylinderGeometry(octRadius, octRadius, height, 8);
                    break;
                case 'var-7': // Столб 7 - Конический столб (размеры из материала)
                    const topRadius = Math.min(postDimensions.width, postDimensions.height) / 3;
                    const bottomRadius = Math.min(postDimensions.width, postDimensions.height) / 2;
                    postGeometry = new THREE.CylinderGeometry(topRadius, bottomRadius, height, 16);
                    break;
                case 'var-8': // Столб 8 - Составной столб (размеры из материала)
                    postGeometry = new THREE.BoxGeometry(postDimensions.width * 0.8, height, postDimensions.height * 0.8);
                    break;
                default:
                    postGeometry = new THREE.BoxGeometry(postDimensions.width, height, postDimensions.height);
            }
            
            // Создание столбов по длинной стороне - от начала до конца балки
            for (let i = 0; i < postsAlongLength; i++) {
                // Равномерное распределение столбов от начала до конца балки
                const z = -length/2 + (i * length / (postsAlongLength - 1));
                
                // Левый ряд столбов (поддерживают левую балку)
                if (postType === 'var-8') {
                    // Составной столб - создаем два элемента
                    const post1 = new THREE.Mesh(postGeometry, woodMaterial);
                    post1.position.set(-width/2 - 0.05, height/2, z);
                    post1.castShadow = true;
                    post1.receiveShadow = true;
                    canopyGroup.add(post1);
                    
                    const post2 = new THREE.Mesh(postGeometry, woodMaterial);
                    post2.position.set(-width/2 + 0.05, height/2, z);
                    post2.castShadow = true;
                    post2.receiveShadow = true;
                    canopyGroup.add(post2);
                } else {
                    const leftPost = new THREE.Mesh(postGeometry, woodMaterial);
                    leftPost.position.set(-width/2, height/2, z);
                    leftPost.castShadow = true;
                    leftPost.receiveShadow = true;
                    canopyGroup.add(leftPost);
                }
                
                // Правый ряд столбов (поддерживают правую балку)
                if (postType === 'var-8') {
                    // Составной столб - создаем два элемента
                    const post1 = new THREE.Mesh(postGeometry, woodMaterial);
                    post1.position.set(width/2 - 0.05, height/2, z);
                    post1.castShadow = true;
                    post1.receiveShadow = true;
                    canopyGroup.add(post1);
                    
                    const post2 = new THREE.Mesh(postGeometry, woodMaterial);
                    post2.position.set(width/2 + 0.05, height/2, z);
                    post2.castShadow = true;
                    post2.receiveShadow = true;
                    canopyGroup.add(post2);
                } else {
                    const rightPost = new THREE.Mesh(postGeometry, woodMaterial);
                    rightPost.position.set(width/2, height/2, z);
                    rightPost.castShadow = true;
                    rightPost.receiveShadow = true;
                    canopyGroup.add(rightPost);
                }
                
                // Основания столбов (размеры адаптируются под столб)
                const baseSize = Math.max(postDimensions.width, postDimensions.height) + 0.1; // Основание больше столба на 100мм
                const baseGeometry = new THREE.BoxGeometry(baseSize, 0.05, baseSize);
                
                const leftBase = new THREE.Mesh(baseGeometry, metalMaterial);
                leftBase.position.set(-width/2, 0.025, z);
                leftBase.receiveShadow = true;
                canopyGroup.add(leftBase);
                
                const rightBase = new THREE.Mesh(baseGeometry, metalMaterial);
                rightBase.position.set(width/2, 0.025, z);
                rightBase.receiveShadow = true;
                canopyGroup.add(rightBase);
            }
        }
        
        // Функция создания продольных балок
        function createLongitudinalBeams(length, width, height, woodMaterial, frontExtension, backExtension, postMaterial = 'glued-150x150') {
            const beamLength = length + frontExtension + backExtension; // Длина навеса + выпуски
            
            // Получаем размеры балки из материала столбов (балка = столб)
            const beamDimensions = getPostDimensions(postMaterial);
            const beamGeometry = new THREE.BoxGeometry(beamDimensions.width, beamDimensions.height, beamLength);
            
            // Смещение центра балки с учетом разных выпусков
            const beamOffset = (frontExtension - backExtension) / 2;
            
            // Высота балок = высота навеса + толщина балки
            const beamHeight = height + beamDimensions.height;
            
            console.log('Высота балок:', {
                heightNavesa: height,
                beamThickness: beamDimensions.height,
                totalBeamHeight: beamHeight
            });
            
            // Левая балка - с настраиваемыми выпусками
            const leftBeam = new THREE.Mesh(beamGeometry, woodMaterial);
            leftBeam.position.set(-width/2, beamHeight, beamOffset);
            leftBeam.castShadow = true;
            leftBeam.receiveShadow = true;
            canopyGroup.add(leftBeam);
            
            // Правая балка - с настраиваемыми выпусками
            const rightBeam = new THREE.Mesh(beamGeometry, woodMaterial);
            rightBeam.position.set(width/2, beamHeight, beamOffset);
            rightBeam.castShadow = true;
            rightBeam.receiveShadow = true;
            canopyGroup.add(rightBeam);
        }
        
        // Главная функция создания ферм (выбирает тип в зависимости от формы кровли)
        function createTrusses(length, width, height, roofHeight, woodMaterial, roofType, braceType, postMaterial = 'glued-150x150', trussMaterial = 'planed-45x190') {
            // Параметры ферм согласно новым требованиям
            const postDimensions = getPostDimensions(postMaterial);
            const trussParams = {
                span: width, // Пролет фермы (L) - длина нижнего пояса
                rise: roofHeight, // Высота фермы (H) - от низа до конька
                sectionSize: getTrussDimensions(trussMaterial), // Толщина балки из меню сечение ферм
                bottomChordHeight: height + postDimensions.height, // Нижний пояс = высота навеса + толщина балки
                showAxes: false // Флаг для отображения осей (можно включить для отладки)
            };

            const postSpacing = currentPostSpacing;
            const postsAlongLength = Math.ceil(length / postSpacing) + 1;
            
            // Создание ферм над каждым столбом
            console.log('Создание ферм с новой архитектурой:', {
                postsAlongLength: postsAlongLength,
                trussParams: trussParams
            });
            
            for (let i = 0; i < postsAlongLength; i++) {
                const z = -length/2 + (i * length / (postsAlongLength - 1));
                const trussGroup = buildTruss(trussParams, woodMaterial, braceType);
                trussGroup.position.set(0, 0, z);
                canopyGroup.add(trussGroup);
                
                console.log(`Ферма ${i + 1} создана в позиции z=${z.toFixed(2)}`);
            }
        }
        
        // Новая архитектура создания ферм согласно требованиям
        function buildTruss(params, woodMaterial, braceType) {
            const { span, rise, sectionSize, bottomChordHeight, showAxes } = params;
            const L = span; // Пролет фермы
            const H = Math.max(rise, 0.1); // Высота фермы (минимум 0.1м для избежания нулевой высоты)
            
            // Проверка граничных условий
            if (L < 1.0) {
                console.warn('Пролет фермы слишком мал, минимум 1м');
                return new THREE.Group();
            }
            
            // Создание группы для фермы
            const trussGroup = new THREE.Group();
            
            // Размеры сечения (грани треугольника = толщина балки)
            const beamWidth = sectionSize.width;
            const beamHeight = sectionSize.height;
            const beamSize = Math.min(beamWidth, beamHeight); // Используем меньшее значение для квадратного сечения
            
            console.log('Параметры фермы:', {
                span: L,
                rise: H,
                beamSize: beamSize,
                bottomChordHeight: bottomChordHeight
            });
            
            // Узлы фермы в 2D-плоскости XY (координаты относительно центра)
            const nodes = {
                leftBottom: { x: -L/2, y: bottomChordHeight },     // Левый нижний узел
                rightBottom: { x: L/2, y: bottomChordHeight },     // Правый нижний узел
                ridge: { x: 0, y: bottomChordHeight + H },         // Конек (вершина)
                leftQuarter: { x: -L/4, y: bottomChordHeight },    // Левая четверть для раскосов
                rightQuarter: { x: L/4, y: bottomChordHeight },    // Правая четверть для раскосов
                center: { x: 0, y: bottomChordHeight }             // Центр для вертикальной стойки
            };
            
            // 1. Нижний пояс (горизонтальная балка)
            const bottomChord = createBeam(
                nodes.leftBottom, nodes.rightBottom, beamSize, woodMaterial
            );
            trussGroup.add(bottomChord);
            
            // 2. Левый верхний пояс (от левого нижнего к коньку)
            const topLeftChord = createBeam(
                nodes.leftBottom, nodes.ridge, beamSize, woodMaterial
            );
            trussGroup.add(topLeftChord);
            
            // 3. Правый верхний пояс (от конька к правому нижнему)
            const topRightChord = createBeam(
                nodes.ridge, nodes.rightBottom, beamSize, woodMaterial
            );
            trussGroup.add(topRightChord);
            
            // 4. Центральная вертикальная стойка (от центра к коньку)
            const verticalPost = createBeam(
                nodes.center, nodes.ridge, beamSize, woodMaterial
            );
            trussGroup.add(verticalPost);
            
            // 5. Диагональные раскосы (всегда от нижнего пояса к верхнему по направлению к коньку)
            // Левый раскос: от левой четверти к коньку
            const leftDiagonal = createBeam(
                nodes.leftQuarter, nodes.ridge, beamSize, woodMaterial
            );
            trussGroup.add(leftDiagonal);
            
            // Правый раскос: от правой четверти к коньку
            const rightDiagonal = createBeam(
                nodes.rightQuarter, nodes.ridge, beamSize, woodMaterial
            );
            trussGroup.add(rightDiagonal);
            
            // 6. Оси для отладки (если включены)
            if (showAxes) {
                const axesGroup = createTrussAxes(nodes);
                trussGroup.add(axesGroup);
            }
            
            return trussGroup;
        }
        
        // Вспомогательная функция для создания балки между двумя точками
        function createBeam(startNode, endNode, sectionSize, material) {
            const dx = endNode.x - startNode.x;
            const dy = endNode.y - startNode.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            
            // Избегаем создания балок нулевой длины
            if (length < 0.01) {
                console.warn('Попытка создать балку нулевой длины');
                return new THREE.Group();
            }
            
            // Создание геометрии балки
            const beamGeometry = new THREE.BoxGeometry(length, sectionSize, sectionSize);
            const beam = new THREE.Mesh(beamGeometry, material);
            
            // Позиционирование и поворот балки
            const centerX = (startNode.x + endNode.x) / 2;
            const centerY = (startNode.y + endNode.y) / 2;
            beam.position.set(centerX, centerY, 0);
            
            // Поворот балки по углу между точками
            const angle = Math.atan2(dy, dx);
            beam.rotation.z = angle;
            
            // Настройка теней
            beam.castShadow = true;
            beam.receiveShadow = true;
            
            return beam;
        }
        
        // Функция создания осей для отладки
        function createTrussAxes(nodes) {
            const axesGroup = new THREE.Group();
            const axisMaterial = new THREE.LineBasicMaterial({ color: 0xff0000, linewidth: 2 });
            
            // Создаем линии между всеми узлами для визуализации структуры
            Object.keys(nodes).forEach(key => {
                const node = nodes[key];
                const points = [
                    new THREE.Vector3(node.x, node.y, 0),
                    new THREE.Vector3(node.x, node.y, 0.1)
                ];
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const line = new THREE.Line(geometry, axisMaterial);
                axesGroup.add(line);
            });
            
            return axesGroup;
        }

        
        
        
        // Функция создания раскосов
        function createBraces(parentElement, z, height, woodMaterial, braceType, trussType = 'gable') {
            const sectionSize = 0.1; // Раскосы тоньше основных элементов
            
            switch(braceType) {
                case 'var-1': // Без раскосов
                    break;
                case 'var-2': // Простые диагональные раскосы
                    createSimpleBraces(z, height, woodMaterial, sectionSize);
                    break;
                case 'var-3': // Крестообразные раскосы
                    createCrossBraces(z, height, woodMaterial, sectionSize);
                    break;
                case 'var-4': // Вертикальные стойки
                    createVerticalBraces(z, height, woodMaterial, sectionSize);
                    break;
                default:
                    createSimpleBraces(z, height, woodMaterial, sectionSize);
            }
        }
        
        function createSimpleBraces(z, height, woodMaterial, sectionSize) {
            // Простые диагональные раскосы
            const braceLength = Math.sqrt(1 + 1); // Диагональ квадрата
            const braceGeometry = new THREE.BoxGeometry(braceLength, sectionSize, sectionSize);
            
            const leftBrace = new THREE.Mesh(braceGeometry, woodMaterial);
            leftBrace.position.set(-0.5, height + 0.5, z);
            leftBrace.rotation.z = Math.PI / 4;
            leftBrace.castShadow = true;
            canopyGroup.add(leftBrace);
            
            const rightBrace = new THREE.Mesh(braceGeometry, woodMaterial);
            rightBrace.position.set(0.5, height + 0.5, z);
            rightBrace.rotation.z = -Math.PI / 4;
            rightBrace.castShadow = true;
            canopyGroup.add(rightBrace);
        }
        
        function createCrossBraces(z, height, woodMaterial, sectionSize) {
            // Крестообразные раскосы
            const braceLength = Math.sqrt(2 + 1);
            const braceGeometry = new THREE.BoxGeometry(braceLength, sectionSize, sectionSize);
            
            // Левый крест
            const leftBrace1 = new THREE.Mesh(braceGeometry, woodMaterial);
            leftBrace1.position.set(-0.75, height + 0.5, z);
            leftBrace1.rotation.z = Math.PI / 4;
            leftBrace1.castShadow = true;
            canopyGroup.add(leftBrace1);
            
            const leftBrace2 = new THREE.Mesh(braceGeometry, woodMaterial);
            leftBrace2.position.set(-0.75, height + 0.5, z);
            leftBrace2.rotation.z = -Math.PI / 4;
            leftBrace2.castShadow = true;
            canopyGroup.add(leftBrace2);
            
            // Правый крест
            const rightBrace1 = new THREE.Mesh(braceGeometry, woodMaterial);
            rightBrace1.position.set(0.75, height + 0.5, z);
            rightBrace1.rotation.z = Math.PI / 4;
            rightBrace1.castShadow = true;
            canopyGroup.add(rightBrace1);
            
            const rightBrace2 = new THREE.Mesh(braceGeometry, woodMaterial);
            rightBrace2.position.set(0.75, height + 0.5, z);
            rightBrace2.rotation.z = -Math.PI / 4;
            rightBrace2.castShadow = true;
            canopyGroup.add(rightBrace2);
        }
        
        function createVerticalBraces(z, height, woodMaterial, sectionSize) {
            // Вертикальные стойки
            const braceGeometry = new THREE.BoxGeometry(sectionSize, 1, sectionSize);
            
            const leftBrace = new THREE.Mesh(braceGeometry, woodMaterial);
            leftBrace.position.set(-0.5, height + 0.5, z);
            leftBrace.castShadow = true;
            canopyGroup.add(leftBrace);
            
            const rightBrace = new THREE.Mesh(braceGeometry, woodMaterial);
            rightBrace.position.set(0.5, height + 0.5, z);
            rightBrace.castShadow = true;
            canopyGroup.add(rightBrace);
        }
        
        // Функция создания кровельного покрытия
        function createRoofCovering(length, width, height, roofHeight, roofingMaterial, frontExtension, backExtension, roofType = 'var-2') {
            const roofingMaterial_value = document.getElementById('roofingMaterial')?.value || 'metal-grandline';
            
            // Не создаем кровлю если выбрано "без кровли"
            if (roofingMaterial_value === 'no-roofing') {
                return;
            }
            
            // Размеры кровли с учетом выпусков балок
            const roofLength = length + frontExtension + backExtension;
            const roofWidth = width + 0.4; // Добавляем 200мм с каждой стороны по ширине
            
            // Смещение центра кровли с учетом разных выпусков
            const roofOffset = (frontExtension - backExtension) / 2;
            
            // Создание кровли в зависимости от типа каркаса
            if (roofType === 'var-1') {
                // Односкатная кровля
                const singleRoofGeometry = new THREE.PlaneGeometry(roofLength, roofWidth);
                const singleRoof = new THREE.Mesh(singleRoofGeometry, roofingMaterial);
                singleRoof.position.set(0, height + roofHeight/2, roofOffset);
                singleRoof.rotation.x = -Math.PI/2 + Math.atan(roofHeight / (width + 0.4));
                singleRoof.castShadow = true;
                singleRoof.receiveShadow = true;
                canopyGroup.add(singleRoof);
            } else if (roofType === 'var-3') {
                // Арочная кровля
                const archRadius = (width + 0.4) / 2;
                const archGeometry = new THREE.CylinderGeometry(archRadius, archRadius, roofLength, 16, 1, false, 0, Math.PI);
                const archRoof = new THREE.Mesh(archGeometry, roofingMaterial);
                archRoof.position.set(0, height + roofHeight * 0.7, roofOffset);
                archRoof.rotation.z = Math.PI/2;
                archRoof.castShadow = true;
                archRoof.receiveShadow = true;
                canopyGroup.add(archRoof);
            } else if (roofHeight > 0) {
                // Двускатная кровля
                // Левый скат
                const leftRoofGeometry = new THREE.PlaneGeometry(roofLength, Math.sqrt((width/2 + 0.2) * (width/2 + 0.2) + roofHeight * roofHeight));
                const leftRoof = new THREE.Mesh(leftRoofGeometry, roofingMaterial);
                leftRoof.position.set(-width/4 - 0.1, height + roofHeight/2, roofOffset);
                leftRoof.rotation.z = -Math.atan(roofHeight / (width/2 + 0.2));
                leftRoof.rotation.x = -Math.PI/2;
                leftRoof.castShadow = true;
            leftRoof.receiveShadow = true;
            canopyGroup.add(leftRoof);
            
                // Правый скат
                const rightRoofGeometry = new THREE.PlaneGeometry(roofLength, Math.sqrt((width/2 + 0.2) * (width/2 + 0.2) + roofHeight * roofHeight));
                const rightRoof = new THREE.Mesh(rightRoofGeometry, roofingMaterial);
                rightRoof.position.set(width/4 + 0.1, height + roofHeight/2, roofOffset);
                rightRoof.rotation.z = Math.atan(roofHeight / (width/2 + 0.2));
                rightRoof.rotation.x = -Math.PI/2;
                rightRoof.castShadow = true;
            rightRoof.receiveShadow = true;
            canopyGroup.add(rightRoof);
            } else {
                // Плоская кровля
                const flatRoofGeometry = new THREE.PlaneGeometry(roofLength, roofWidth);
                const flatRoof = new THREE.Mesh(flatRoofGeometry, roofingMaterial);
                flatRoof.position.set(0, height + 0.05, roofOffset); // Немного выше балок
                flatRoof.rotation.x = -Math.PI/2;
                flatRoof.castShadow = true;
                flatRoof.receiveShadow = true;
                canopyGroup.add(flatRoof);
            }
        }
        
        // Функция создания земли
        function createGround() {
            const groundGeometry = new THREE.PlaneGeometry(50, 50);
            const groundMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x8B4513, // Коричневая земля
                shininess: 0
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            const canvas = document.getElementById('canopy3D');
            const container = canvas.parentElement;
            
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function resetCamera() {
            camera.position.set(15, 10, 15);
            controls.reset();
        }
        
        function download3DImage() {
            const link = document.createElement('a');
            link.download = 'canopy_3d.png';
            link.href = renderer.domElement.toDataURL();
            link.click();
        }
        
        // Функция для тестирования обновления сечения столбов
        function testPostSectionUpdate() {
            const element = document.getElementById('specPostSection');
            if (element) {
                console.log('Before update:', element.textContent);
                element.textContent = '200×200 мм';
                console.log('After update:', element.textContent);
                console.log('Test update successful');
            } else {
                console.error('Element not found');
            }
        }
        
        // Функция для тестирования обновления через updatePostSection
        function testUpdatePostSection() {
            console.log('Testing updatePostSection function...');
            updatePostSection('glued-200x200');
        }
        
        // Функция для принудительного обновления элемента
        function forceUpdatePostSection() {
            const element = document.getElementById('specPostSection');
            if (element) {
                console.log('Before update:', element.textContent);
                element.textContent = '200×200 мм';
                console.log('After update:', element.textContent);
                console.log('Force update successful');
            } else {
                console.error('Element not found');
            }
        }
        
        // Функция для проверки всех элементов
        function debugElements() {
            console.log('=== DEBUG ELEMENTS ===');
            
            // Проверяем postMaterial select
            const postMaterialSelect = document.getElementById('postMaterial');
            console.log('postMaterial select:', postMaterialSelect);
            if (postMaterialSelect) {
                console.log('postMaterial value:', postMaterialSelect.value);
            }
            
            // Проверяем specPostSection element
            const specPostSectionElement = document.getElementById('specPostSection');
            console.log('specPostSection element:', specPostSectionElement);
            if (specPostSectionElement) {
                console.log('specPostSection value:', specPostSectionElement.textContent);
            }
            
            // Ищем все элементы с текстом "Сечение столбов"
            const allElements = document.querySelectorAll('*');
            allElements.forEach(element => {
                if (element.textContent && element.textContent.includes('Сечение столбов')) {
                    console.log('Found element with "Сечение столбов":', element);
                }
            });
        }
        
        // Функция для проверки всех элементов спецификации
        function checkSpecElements() {
            const elements = [
                'specPosts',
                'specPostType', 
                'specPostMaterial',
                'specPostSection',
                'specHeightLeft',
                'specHeightRight'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    console.log(`${id}:`, element.textContent);
                } else {
                    console.error(`${id}: element not found`);
                }
            });
        }
        
        // Функция для поиска правильного элемента сечения столбов
        function findPostSectionElement() {
            console.log('Searching for post section element...');
            
            // Ищем по ID
            const byId = document.getElementById('specPostSection');
            console.log('By ID specPostSection:', byId);
            
            // Ищем по тексту
            const allElements = document.querySelectorAll('*');
            allElements.forEach(element => {
                if (element.textContent && element.textContent.includes('Сечение столбов')) {
                    console.log('Found element with "Сечение столбов":', element);
                    console.log('Parent element:', element.parentElement);
                    console.log('Next sibling:', element.nextElementSibling);
                }
            });
            
            // Ищем по тексту "150"
            allElements.forEach(element => {
                if (element.textContent && element.textContent.includes('150') && element.textContent.includes('мм')) {
                    console.log('Found element with "150" and "мм":', element);
                }
            });
        }
        
        // Функция для принудительной инициализации postMaterial
        function initPostMaterial() {
            const postMaterialSelect = document.getElementById('postMaterial');
            if (postMaterialSelect) {
                postMaterialSelect.addEventListener('change', function() {
                    // Прямое обновление элемента сечения столбов
                    updatePostSection(this.value);
                    
                    calculateTotal();
                });
            }
        }
        
        // Функция для прямого обновления сечения столбов
        function updatePostSection(postMaterialValue) {
            const postSectionNames = {
                'glued-100x100': '100×100 мм',
                'glued-200x200': '200×200 мм',
                'glued-300x300': '300×300 мм',
                'glued-240x140': '240×140 мм',
                'glued-140x340': '140×340 мм',
                'glued-240x240': '240×240 мм',
                'glued-100x150': '100×150 мм',
                'glued-150x150': '150×150 мм',
                'planed-90x90': '90×90 мм',
                'planed-140x140': '140×140 мм',
                'planed-190x190': '190×190 мм',
                'planed-240x240': '240×240 мм',
                'glued-200x200-larch': '200×200 мм',
                'glued-250x150-larch': '250×150 мм',
                'glued-250x150-larch-8m': '250×150 мм'
            };
            
            const postSectionValue = postSectionNames[postMaterialValue] || '150×150 мм';
            
            const specPostSectionElement = document.getElementById('specPostSection');
            if (specPostSectionElement) {
                specPostSectionElement.textContent = postSectionValue;
            }
        }
        
        // Обновление 3D модели при изменении параметров
        function update3DModel() {
            if (canopyGroup && scene && renderer) {
                createCanopy();
            }
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            initSliders();
            initToggleSection();
            initSpecification();
            initSelects();
            initRadioButtons();
            initPostMaterial();
            init3DScene(); // Инициализация 3D сцены
            
            // Тест материалов (можно удалить после проверки)
            testAllMaterials();
            loadDefaultExcel().then(() => {
                calculateTotal();
                
                // Принудительная инициализация postMaterial с задержкой
                setTimeout(() => {
                    const postMaterialSelect = document.getElementById('postMaterial');
                    if (postMaterialSelect) {
                        postMaterialSelect.addEventListener('change', function() {
                            updatePostSection(this.value);
                        });
                    }
                }, 1000);
                
                // Инициализация 3D сцены после загрузки данных
                setTimeout(() => {
                    init3DScene();
                }, 100);
            });
        });
    </script>
    <!-- jQuery и jQuery UI из папки calc -->
    <script src="calc/js/calc/jquery-3.7.1.min.js"></script>
    <script src="calc/js/calc/jquery-ui-1.14.1/jquery-ui.min.js"></script>
    <script src="calc/js/calc/jquery.ui.touch-punch.min.js"></script>

</body>
</html>
