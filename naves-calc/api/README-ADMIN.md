# 🔐 Админ-панель - Инструкция

**Версия:** 1.0  
**Файл:** `api/admin.html`

---

## 📋 Описание

Веб-интерфейс для просмотра и управления заказами навесов.

### Возможности:
- 📊 Статистика заказов (всего, сегодня, сумма)
- 📋 Список всех заказов
- 🔍 Поиск по имени, телефону, ID
- 📧 Быстрые действия (звонок, email)
- 📥 Экспорт в Excel/CSV
- 🔄 Автообновление каждые 30 сек
- 📱 Адаптивный дизайн

---

## 🚀 Как открыть

### Вариант 1: Напрямую (файл)
```
Откройте в браузере:
file:///путь/к/naves-calc/api/admin.html
```

⚠️ **Ограничение:** Не сможет загружать заказы из-за CORS.

### Вариант 2: Через веб-сервер (рекомендуется)
```
http://your-site.com/naves-calc/api/admin.html
```

✅ Полная функциональность, доступ к API.

---

## 🔌 Требования

### Для работы нужен backend:

**PHP вариант:**
- Заказы в папке `api/orders/*.json`
- Работает "из коробки"

**Node.js вариант:**
- Запущенный сервер на порту 3000
- Endpoint: `GET /api/orders`

---

## 📊 Интерфейс

### Верхняя панель (Статистика):
```
┌─────────────┬─────────────┬──────────────┐
│ Всего       │ Сегодня     │ Общая сумма  │
│ 42 заказа   │ 5 заказов   │ 2 500 000 ₽  │
└─────────────┴─────────────┴──────────────┘
```

### Панель управления:
```
┌─────────────────────────────────────────┐
│ 🔍 Поиск...  [🔄 Обновить] [📥 Экспорт] │
└─────────────────────────────────────────┘
```

### Список заказов:
```
┌────────────────────────────────────────┐
│ #ORD-20251105-xxx                      │
│ 📅 05.11.2025, 22:00                   │
│                                         │
│ 👤 Иван Иванов    📞 +7 999 123-45-67  │
│ 📧 ivan@mail.ru   📐 11×6 м             │
│                                         │
│ 💰 150 000 ₽                           │
│                                         │
│ [Развернуть детали ↓]                  │
└────────────────────────────────────────┘
```

### Детали заказа (при клике):
```
┌────────────────────────────────────────┐
│ 📋 Параметры навеса:                   │
│ • Длина: 11 м                          │
│ • Ширина: 6 м                          │
│ • Высота: 3 м                          │
│ • Площадь: 66 м²                       │
│ • Тип кровли: var-2                    │
│ • Материал столбов: glued-150x150      │
│ • Материал кровли: metal-grandline     │
│                                         │
│ 📍 Адрес доставки:                     │
│ Москва, ул. Примерная, 10              │
│                                         │
│ 💬 Комментарий клиента:                │
│ Доставка в выходные                    │
│                                         │
│ [📞 Позвонить] [📧 Написать] [🗑️ Удалить] │
└────────────────────────────────────────┘
```

---

## 🔍 Поиск

Поддерживает поиск по:
- ID заказа (ORD-...)
- Имени клиента
- Телефону
- Email

**Пример:**
```
Иван      → Найдет всех Иванов
+7 999    → Найдет по номеру
ORD-2025  → Найдет по ID
```

---

## 📥 Экспорт в Excel

Формат CSV с кодировкой UTF-8 (с BOM):

```csv
ID,Дата,Имя,Телефон,Email,Размеры,Площадь,Стоимость
"ORD-xxx","05.11.2025, 22:00","Иван","79991234567","ivan@mail.ru","11x6м","66м²","150000₽"
```

Открывается в Excel корректно (кириллица поддерживается).

---

## ⚙️ Настройка

### Изменение интервала автообновления:

В `admin.html` (последняя строка):
```javascript
// По умолчанию: 30 секунд
setInterval(loadOrders, 30000);

// Изменить на 1 минуту:
setInterval(loadOrders, 60000);

// Отключить автообновление:
// setInterval(loadOrders, 30000);
```

### Изменение API endpoint:

В `admin.html` (функция `loadOrders`):
```javascript
// По умолчанию: /api/orders
const response = await fetch('/api/orders');

// Изменить на другой:
const response = await fetch('http://your-server.com:3000/api/orders');
```

---

## 🔒 Безопасность

### Защита доступа

#### Вариант 1: Basic Auth (Nginx)

```nginx
location /api/admin.html {
    auth_basic "Restricted Access";
    auth_basic_user_file /etc/nginx/.htpasswd;
}
```

Создание пароля:
```bash
sudo apt install apache2-utils
sudo htpasswd -c /etc/nginx/.htpasswd admin
sudo systemctl reload nginx
```

#### Вариант 2: .htaccess (Apache)

Создайте `api/.htaccess`:
```apache
<Files "admin.html">
    AuthType Basic
    AuthName "Restricted Area"
    AuthUserFile /path/to/.htpasswd
    Require valid-user
</Files>
```

Создание пароля:
```bash
htpasswd -c /path/to/.htpasswd admin
```

#### Вариант 3: IP ограничение

Nginx:
```nginx
location /api/admin.html {
    allow 192.168.1.0/24;
    deny all;
}
```

Apache (.htaccess):
```apache
<Files "admin.html">
    Order Deny,Allow
    Deny from all
    Allow from 192.168.1.0/24
</Files>
```

---

## 📱 Мобильная версия

Админ-панель полностью адаптирована под мобильные устройства:
- ✅ Адаптивная сетка
- ✅ Удобные кнопки
- ✅ Сенсорное управление
- ✅ Оптимизированные шрифты

---

## 🐛 Решение проблем

### Заказы не загружаются

**Причина:** Backend не доступен

**Решение:**
1. Проверьте что backend запущен:
   ```bash
   # PHP
   sudo systemctl status php8.1-fpm
   
   # Node.js
   sudo systemctl status naves-api
   ```

2. Проверьте консоль браузера (F12) на ошибки CORS

3. Убедитесь что путь к API правильный

### "Permission denied" при экспорте

**Причина:** Браузер блокирует скачивание

**Решение:**
1. Разрешите скачивание файлов для сайта
2. Проверьте настройки безопасности браузера

### Статистика показывает 0

**Причина:** Нет файлов заказов или нет доступа

**Решение:**
1. Проверьте папку `api/orders/`
2. Убедитесь что есть файлы `*.json`
3. Проверьте права доступа

---

## 🎨 Кастомизация

### Изменение цветовой схемы:

В `admin.html` (раздел `<style>`):
```css
/* Основной цвет */
--primary-color: #667eea;

/* Изменить на другой: */
--primary-color: #20B5B9;
```

### Изменение логотипа:

Замените эмодзи в заголовке:
```html
<h1>🏗️ Админ-панель заказов навесов</h1>

<!-- На свой логотип: -->
<h1><img src="/logo.png"> Админ-панель</h1>
```

---

## 📊 Расширенные возможности

### Добавление фильтров по дате

Добавьте в панель управления:
```html
<input type="date" id="dateFrom" onchange="filterByDate()">
<input type="date" id="dateTo" onchange="filterByDate()">
```

### Добавление сортировки

Добавьте кнопки:
```html
<button onclick="sortOrders('date')">По дате</button>
<button onclick="sortOrders('price')">По цене</button>
```

### Интеграция с CRM

Добавьте отправку в CRM:
```javascript
async function sendToCRM(orderId) {
    const order = allOrders.find(o => o.orderId === orderId);
    
    await fetch('https://your-crm.com/api/leads', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(order)
    });
}
```

---

## ✅ Чеклист

Перед использованием:
- [ ] Backend запущен и работает
- [ ] Доступ к admin.html защищен паролем
- [ ] Протестирован поиск
- [ ] Протестирован экспорт
- [ ] Проверено на мобильном устройстве

---

## 📞 Поддержка

При возникновении проблем:
1. Проверьте консоль браузера (F12)
2. Проверьте логи backend
3. Убедитесь что пути к API правильные
4. Проверьте права доступа к файлам

---

**Версия:** 1.0  
**Дата:** 05.11.2025

✅ **Готово к использованию!**

