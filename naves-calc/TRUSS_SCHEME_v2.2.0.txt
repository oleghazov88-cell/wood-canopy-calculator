╔══════════════════════════════════════════════════════════════════════════════════╗
║            ТРЕУГОЛЬНАЯ ФЕРМА С УСОВЫМИ ПОДРЕЗКАМИ v2.2.0                        ║
║                    (Профессиональная конструкция)                               ║
╚══════════════════════════════════════════════════════════════════════════════════╝


┌─────────────────────────────────────────────────────────────────────────────────┐
│                         ОБЩИЙ ВИД ФЕРМЫ (N=8)                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

                              4 КОНЕК (максимальная высота)
                             /│\
                            / │ \
                           /  │  \
                          /   │   \
         Верхний пояс    /    │    \      (с усовыми подрезками)
         (8 сегментов)  /     │     \
                       /      │      \
                     3        │        5
                    /╲        │        /╲
                   /  ╲       │       /  ╲
                  /    ╲      │      /    ╲
                 /      ╲     │     /      ╲
               2         ╲    │    /         6
              /╲          ╲   │   /          /╲
             /  ╲          ╲  │  /          /  ╲
            /    ╲          ╲ │ /          /    ╲
           /      ╲          ╲│/          /      ╲
         1         ╲          X          /         7
        /╲          ╲        /│\        /          /╲
       /  ╲    Раскосы      / │ \     Раскосы    /  ╲
      /    ╲    (Т-стык)   /  │  \   (Т-стык)  /    ╲
     /      ╲             /   │   \            /      ╲
    /        ╲           /    │    \          /        ╲
   /          ╲         /     │     \        /          ╲
  /__________╲________/______│______╲______/__________╲_
 0            1      2   3   4   5   6      7            8
 ◄────────────────── Нижний пояс (с усами) ────────────────►
                    (8 сегментов)


┌─────────────────────────────────────────────────────────────────────────────────┐
│                        СХЕМА РАСКОСОВ (Решетка)                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

Раскосы чередуются: снизу-вверх, сверху-вниз, снизу-вверх...

   Верх:    *       *       *       *       *
            │╲     ╱│╲     ╱│╲     ╱│╲     ╱│
            │ ╲   ╱ │ ╲   ╱ │ ╲   ╱ │ ╲   ╱ │
            │  ╲ ╱  │  ╲ ╱  │  ╲ ╱  │  ╲ ╱  │
            │   X   │   X   │   X   │   X   │
            │  ╱ ╲  │  ╱ ╲  │  ╱ ╲  │  ╱ ╲  │
            │ ╱   ╲ │ ╱   ╲ │ ╱   ╲ │ ╱   ╲ │
            │╱     ╲│╱     ╲│╱     ╲│╱     ╲│
   Низ:     *       *       *       *       *
            0   1   2   3   4   5   6   7   8

Тип раскоса:
   i=0: bot[0] → top[1]  (четный, снизу-вверх)
   i=1: top[1] → bot[2]  (нечетный, сверху-вниз)
   i=2: bot[2] → top[3]  (четный, снизу-вверх)
   i=3: top[3] → bot[4]  (нечетный, сверху-вниз)
   ...и так далее


┌─────────────────────────────────────────────────────────────────────────────────┐
│                         УСОВАЯ ПОДРЕЗКА (Miter Cut)                             │
└─────────────────────────────────────────────────────────────────────────────────┘

БЕЗ усовой подрезки (ЩЕЛЬ в узле):
   ════════════╗              ╔════════════
               ║              ║
               ║   ← ЩЕЛЬ! →  ║
               ║              ║
               ╚══════════════╝
                     УЗЕЛ

С усовой подрезкой (ИДЕАЛЬНЫЙ СТЫК):
   ═══════════╗╔═══════════
              ║║
              ║║ ← НЕТ ЩЕЛИ!
              ║║
              ╚╝
             УЗЕЛ

Принцип:
   Каждый стержень укорачивается на расстояние s
   s = (b / 2) / tan(φ / 2)
   где:
      b = ширина сечения
      φ = угол между стержнями


┌─────────────────────────────────────────────────────────────────────────────────┐
│                    ДЕТАЛИЗАЦИЯ: УЗЕЛ НА КОНЬКЕ                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

Вид спереди:
                     КОНЕК
                       │
        Левый сегмент  │  Правый сегмент
              ╲        │        ╱
               ╲       │       ╱
                ╲      │      ╱
          ╔══════╲     │     ╱══════╗
          ║       ╲    │    ╱       ║
          ║        ╲   │   ╱        ║  ← Верхний пояс
          ║         ╲  │  ╱         ║
          ║          ╲ │ ╱          ║
          ╚═══════════╲│╱═══════════╝
                       X
                    (узел i)

Усовая подрезка:
   - Левый сегмент укорачивается справа на s
   - Правый сегмент укорачивается слева на s
   - Стержни точно стыкуются в узле


┌─────────────────────────────────────────────────────────────────────────────────┐
│                     КООРДИНАТЫ УЗЛОВ (формулы)                                  │
└─────────────────────────────────────────────────────────────────────────────────┘

Входные параметры:
   L = пролет фермы (span)
   H = подъем фермы (rise)
   bottomChordHeight = высота нижнего пояса
   N = количество сегментов (8)

Нижний пояс (горизонтальная линия):
   bot[i].x = -L/2 + L * i / N
   bot[i].y = bottomChordHeight
   bot[i].z = 0
   
   i = 0, 1, 2, ..., N

Верхний пояс (треугольная форма):
   top[i].x = -L/2 + L * i / N
   top[i].y = bottomChordHeight + H * (1 - |2*i/N - 1|)
   top[i].z = 0
   
   i = 0, 1, 2, ..., N

Высота верхнего пояса по узлам (H=2.4м, N=8):
   i=0: y = bottomChordHeight + 0    (край)
   i=1: y = bottomChordHeight + 1.8
   i=2: y = bottomChordHeight + 2.1
   i=3: y = bottomChordHeight + 2.3
   i=4: y = bottomChordHeight + 2.4  (КОНЕК)
   i=5: y = bottomChordHeight + 2.3
   i=6: y = bottomChordHeight + 2.1
   i=7: y = bottomChordHeight + 1.8
   i=8: y = bottomChordHeight + 0    (край)


┌─────────────────────────────────────────────────────────────────────────────────┐
│                         ЭЛЕМЕНТЫ ФЕРМЫ (N=8)                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────┬────────────┬─────────────┬──────────────┬─────────────────────┐
│ Тип         │ Количество │ Начало      │ Конец        │ Подрезки            │
├─────────────┼────────────┼─────────────┼──────────────┼─────────────────────┤
│ Верхний     │     8      │ top[i]      │ top[i+1]     │ ✅ Усовые (s0, s1)  │
│ пояс        │            │             │              │                     │
├─────────────┼────────────┼─────────────┼──────────────┼─────────────────────┤
│ Нижний      │     8      │ bot[i]      │ bot[i+1]     │ ✅ Усовые (s0, s1)  │
│ пояс        │            │             │              │                     │
├─────────────┼────────────┼─────────────┼──────────────┼─────────────────────┤
│ Раскосы     │     8      │ bot[i] или  │ top[i+1] или │ ❌ Нет (Т-стык)     │
│ (решетка)   │            │ top[i]      │ bot[i+1]     │                     │
├─────────────┼────────────┼─────────────┼──────────────┼─────────────────────┤
│ ВСЕГО:      │    24      │             │              │                     │
└─────────────┴────────────┴─────────────┴──────────────┴─────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────┐
│                          ФУНКЦИЯ makeMember()                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

makeMember(P, Q, b, t, sStart, sEnd, material)

Параметры:
   P = начальная точка (Vector3)
   Q = конечная точка (Vector3)
   b = высота сечения (м)
   t = ширина сечения (м)
   sStart = смещение подрезки на начале (м)
   sEnd = смещение подрезки на конце (м)
   material = материал Three.js

Алгоритм:
   1. v = Q - P
   2. L0 = |v|                  (полная длина)
   3. d = v / |v|               (направление)
   4. L = L0 - sStart - sEnd    (эффективная длина)
   5. Создать BoxGeometry(L, b, t)
   6. Pstart = P + d * sStart
   7. Pend = Q - d * sEnd
   8. M = (Pstart + Pend) / 2   (центр бруса)
   9. Повернуть вдоль d
   10. Установить позицию в M

Схема:
   P ──┬────────────────────────────┬── Q
   │   │←sStart   L (брус)   sEnd→│ │
   │   │                            │ │
   │   Pstart                    Pend│
   │            M (центр)            │


┌─────────────────────────────────────────────────────────────────────────────────┐
│                       РАСЧЕТ УСОВЫХ ПОДРЕЗОК                                    │
└─────────────────────────────────────────────────────────────────────────────────┘

Для каждого внутреннего узла цепочки (i = 1..N-1):

   1. Взять два соседних сегмента:
      seg[k]:   P_k ────→ узел_i
      seg[k+1]: узел_i ────→ Q_(k+1)

   2. Вычислить направления:
      u_in  = unit(P_k - узел_i)     (входящий вектор)
      u_out = unit(Q_(k+1) - узел_i) (исходящий вектор)

   3. Вычислить угол между ними:
      φ = arccos(u_in · u_out)

   4. Вычислить смещение:
      s = (b / 2) / tan(φ / 2)

   5. Применить подрезки:
      seg[k].s1 = s      (правый конец левого сегмента)
      seg[k+1].s0 = s    (левый конец правого сегмента)

Применяется к:
   ✅ Верхнему поясу (type='top')
   ✅ Нижнему поясу (type='bot')
   ❌ Раскосам (type='web') - Т-стык


┌─────────────────────────────────────────────────────────────────────────────────┐
│                        МАТЕМАТИЧЕСКИЕ ФОРМУЛЫ                                   │
└─────────────────────────────────────────────────────────────────────────────────┘

1. Нормализация вектора:
   unit(v) = v / |v|

2. Угол между векторами:
   φ = arccos(clamp(u · v, -1, 1))

3. Смещение для усовой подрезки:
   s = (b / 2) / tan(φ / 2)

4. Длина бруса с подрезками:
   L_effective = L_full - s_start - s_end

5. Центр бруса:
   M = (P + s_start * d + Q - s_end * d) / 2
   где d = unit(Q - P)

6. Длина верхнего пояса (теоретическая):
   L_top = 2 * √((L/2)² + H²)

7. Угол наклона стропил:
   α = arctan(H / (L/2))


┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ПАРАМЕТРЫ ПО УМОЛЧАНИЮ                                │
└─────────────────────────────────────────────────────────────────────────────────┘

N = 8               // количество сегментов
b = 0.12 м          // высота сечения (120 мм)
t = 0.06 м          // ширина сечения (60 мм)

Для изменения N:
   - Открыть: naves-calc/assets/js/naves-calc.bundle.js
   - Найти: строка ~2055
   - Изменить: const N = 8; // ← здесь


┌─────────────────────────────────────────────────────────────────────────────────┐
│                         ПРЕИМУЩЕСТВА v2.2.0                                     │
└─────────────────────────────────────────────────────────────────────────────────┘

✅ РЕАЛИСТИЧНОСТЬ:
   └─ Профессиональная конструкция
   └─ Усовые подрезки (как в реальных фермах)
   └─ Решетчатая структура с раскосами

✅ ТОЧНОСТЬ:
   └─ Автоматический расчет всех углов
   └─ Идеальная стыковка без щелей
   └─ Учет геометрии сечения

✅ ПРОЧНОСТЬ:
   └─ Раскосы распределяют нагрузку
   └─ Сегментированная конструкция
   └─ Оптимальная решетка

✅ УНИВЕРСАЛЬНОСТЬ:
   └─ Работает для любых размеров
   └─ Настраиваемое количество сегментов
   └─ Адаптивная геометрия


┌─────────────────────────────────────────────────────────────────────────────────┐
│                         СРАВНЕНИЕ ВЕРСИЙ                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

┌────────────┬─────────────────┬─────────────────┬─────────────────┐
│ Параметр   │ v2.1.2          │ v2.2.0          │ Улучшение       │
├────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Элементов  │ 3               │ 24              │ +700%           │
├────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Подрезки   │ Торцевые срезы  │ Усовые          │ Реалистичнее    │
├────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Раскосы    │ Нет             │ Да (8 шт)       │ Прочнее         │
├────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Сегменты   │ Цельные пояса   │ 8 сегментов     │ Модульность     │
├────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Точность   │ Хорошая         │ Высокая         │ Без щелей       │
└────────────┴─────────────────┴─────────────────┴─────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ИСПОЛЬЗОВАНИЕ                                      │
└─────────────────────────────────────────────────────────────────────────────────┘

1. Откройте index.html в браузере
2. Установите параметры навеса:
   - Длина
   - Ширина (пролет)
   - Высота столбов
   - Высота подъема кровли
3. Выберите сечение элементов фермы
4. Ферма создастся автоматически с усовыми подрезками!


═══════════════════════════════════════════════════════════════════════════════════
                        ТРЕУГОЛЬНАЯ ФЕРМА v2.2.0
                  Профессиональная конструкция с усовыми подрезками
                        
                        Реализовано: 27 октября 2025
                              Статус: ✅ Готово
═══════════════════════════════════════════════════════════════════════════════════

