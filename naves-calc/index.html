<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –Ω–∞–≤–µ—Å–æ–≤</title>
    <link rel="stylesheet" href="./assets/css/naves-calc.css?v=2">
    <style>
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* === NATURAL MINIMALISM THEME === */
        :root {
            /* Palette */
            --nc-color-brand: #20B5B9;
            /* Forest Teal */
            --nc-color-cta: #FFB74D;
            /* Amber Oak */
            --nc-color-price: #2D3748;
            /* Deep Slate */
            --nc-color-text: #4A5568;
            /* Charcoal */
            --nc-color-text-light: #718096;
            /* Cool Gray */

            /* Backgrounds */
            --nc-bg-page: #F7FAFC;
            /* Soft Cloud */
            --nc-bg-card: #FFFFFF;
            /* Pure White */
            --nc-bg-input: #EDF2F7;

            /* Style Tokens */
            --nc-radius: 12px;
            --nc-shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --nc-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --nc-border: 1px solid #E2E8F0;
        }

        /* Global Overrides */
        body {
            background-color: var(--nc-bg-page);
            color: var(--nc-color-text);
        }

        /* Modernized Card Style */
        .calculator-right-img-block,
        .naves-calc__form,
        .nc-summary {
            background: var(--nc-bg-card) !important;
            border-radius: var(--nc-radius) !important;
            box-shadow: var(--nc-shadow-soft) !important;
            border: var(--nc-border) !important;
        }

        /* Buttons Update */
        .btn,
        .nc-btn,
        .button-red {
            border-radius: var(--nc-radius) !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }

        .btn:hover,
        .nc-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--nc-shadow-hover);
        }

        /* Secondary Button (Action) */
        .bg-red,
        .btn-primary,
        .button-red {
            background: var(--nc-color-cta) !important;
            color: #2D3748 !important;
            /* Dark text on amber for contrast */
            font-weight: 700 !important;
        }

        /* Price Tag Update */
        .price,
        .nc-summary__price {
            color: var(--nc-color-price) !important;
            font-family: inherit;
            /* Use clean font */
            font-weight: 700 !important;
        }

        /* Inputs & Sliders */
        .nc-field__input,
        select.select {
            background-color: var(--nc-bg-input) !important;
            border: 1px solid transparent !important;
            border-radius: 8px !important;
            color: var(--nc-color-text) !important;
        }

        .nc-field__input:focus,
        select.select:focus {
            background-color: #FFF !important;
            border-color: var(--nc-color-brand) !important;
            box-shadow: 0 0 0 3px rgba(32, 181, 185, 0.15) !important;
        }


        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è 3D –æ–∫–Ω–∞ */
        #nc-canvas {
            will-change: transform;
            transform: translateZ(0);
        }

        .naves-calc__view {
            position: relative;
            overflow: hidden;
        }

        /* –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ 3D –æ–∫–Ω–æ */
        .images-block.fullscreen-mode {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            min-height: 100vh !important;
            –∞ –∫–∞–∫ z-index: 1000;
            border-radius: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .images-block.fullscreen-mode #nc-canvas,
        body.fullscreen-3d #nc-canvas {
            width: 100vw !important;
            height: 100vh !important;
            min-height: 100vh !important;
            max-width: 100vw !important;
            max-height: 100vh !important;
            border-radius: 0 !important;
            margin: 0 !important;
            display: block !important;
        }

        .calculator-right-img-block.fullscreen-mode {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            padding: 0 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            z-index: 999;
        }

        body.fullscreen-3d .path-top {
            position: fixed !important;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        body.fullscreen-3d .images-button {
            position: fixed !important;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        body.fullscreen-3d .camera-controls {
            position: fixed !important;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
        }

        body.fullscreen-3d .path-bottom {
            position: fixed !important;
            bottom: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Å–ª–µ–≤–∞ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ */
        body.fullscreen-3d #nc-form {
            display: none !important;
        }

        body.fullscreen-3d section#nc-form {
            display: none !important;
        }

        body.fullscreen-3d .naves-calc>section:first-child {
            display: none !important;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ */
        body.fullscreen-3d #nc-summary {
            display: none !important;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –æ–±–µ—Ä—Ç–∫—É —Ñ–æ—Ä–º—ã */
        body.fullscreen-3d .naves-calc>section:first-child {
            display: none !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: 0 !important;
            flex: 0 0 0 !important;
        }

        /* –£–±–∏—Ä–∞–µ–º –æ–±–µ—Ä—Ç–∫—É –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ */
        body.fullscreen-3d .naves-calc-wrapper {
            padding: 0 !important;
            margin: 0 !important;
            max-width: 100% !important;
        }

        body.fullscreen-3d .naves-calc {
            margin: 0 !important;
            gap: 0 !important;
        }

        body.fullscreen-3d .naves-calc__view {
            flex: 1 1 100% !important;
            width: 100vw !important;
            max-width: 100vw !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            height: 100vh !important;
            z-index: 998 !important;
        }

        body.fullscreen-3d .calculator-right-img-block.fullscreen-mode {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            padding: 0 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            z-index: 999 !important;
            background: #f9f9f9 !important;
        }

        body.fullscreen-3d .images-block.fullscreen-mode {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            min-height: 100vh !important;
            z-index: 1000 !important;
            border-radius: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            background: transparent !important;
        }

        /* ‚úÖ –£–î–ê–õ–ï–ù–û: CSS —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (175 —Å—Ç—Ä–æ–∫) */

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∞–≤–æ–≥–æ –±–ª–æ–∫–∞ —Å 3D –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å test.html */
        .calculator-right-img-block {
            background: white;
            border-radius: 25px;
            padding: 40px;
            width: 100%;
            box-sizing: border-box;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            border: 1px solid #e9ecef;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .path-top {
            margin-bottom: 30px;
        }

        .path-top-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .price {
            font-family: var(--nc-font-heading);
            font-size: 30px;
            font-weight: 600;
            color: #EB1B24;
        }

        .link-360 {
            color: #666;
            text-decoration: none;
            font-size: 15px;
        }

        .button-row {
            display: flex;
            gap: 10px;
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-63 {
            height: 63px;
        }

        .bg-red {
            background: linear-gradient(90deg, #EB1B24 0%, #FF5058 100%);
            color: white;
        }

        .bg-pink {
            background: linear-gradient(90deg, #FF6B9D 0%, #FF8E9B 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .images-block {
            flex: 1;
            min-height: 400px;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .images-button {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }

        .save-btn {
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .path-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 18px;
            font-weight: 500;
            margin-top: 20px;
        }

        .scroll-link {
            color: #EB1B24;
            text-decoration: none;
            line-height: 1.1;
        }

        .scroll-link:hover {
            text-decoration: underline;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π —Å–ª–∞–π–¥–µ—Ä–æ–≤ */
        .slider-description {
            margin-bottom: 10px;
        }

        .description-text {
            font-size: 14px;
            color: #666;
            font-style: italic;
            line-height: 1.4;
        }

        .naves-calc__view canvas {
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä–æ–π */
        .camera-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
        }

        .camera-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-btn:hover {
            background: rgba(32, 181, 185, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(32, 181, 185, 0.3);
        }

        .camera-btn:active {
            transform: translateY(0);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–∞–º–µ—Ä—ã */
        @media (max-width: 992px) {
            .calculator-right-img-block {
                padding: 30px;
                border-radius: 20px;
            }

            .path-top-info {
                flex-wrap: wrap;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .camera-controls {
                top: 10px;
                right: 10px;
                gap: 6px;
            }

            .camera-btn {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }

            .calculator-right-img-block {
                padding: 20px;
                border-radius: 15px;
                width: 100%;
                box-sizing: border-box;
            }

            .path-top {
                margin-bottom: 20px;
            }

            .path-top-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .price {
                font-size: 24px;
            }

            .button-row {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }

            .btn-63 {
                height: 50px;
                width: 100%;
            }

            .images-block {
                min-height: 300px;
                width: 100%;
            }

            .path-bottom {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .hide_992 {
                display: none !important;
            }
        }

        @media (max-width: 576px) {
            .calculator-right-img-block {
                padding: 15px;
                border-radius: 10px;
            }

            .path-top {
                margin-bottom: 15px;
            }

            .price {
                font-size: 20px;
            }

            .btn {
                font-size: 14px;
                padding: 12px 16px;
            }

            .images-block {
                min-height: 250px;
            }

            .images-button {
                top: 10px;
                right: 10px;
            }

            .save-btn {
                width: 35px;
                height: 35px;
            }

            .path-top-info {
                font-size: 14px;
            }

            .link-360 {
                font-size: 13px;
            }
        }

        @media (max-width: 400px) {
            .calculator-right-img-block {
                padding: 10px;
            }

            .price {
                font-size: 18px;
            }

            .images-block {
                min-height: 200px;
            }
        }


        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ —Å—Ç–æ–ª–±–æ–≤ */



        .nc-post-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .nc-post-grid.sidebar-mode {
            grid-template-columns: 1fr 1fr;
            /* 2 –∫–æ–ª–æ–Ω–∫–∏ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ */
            gap: 10px;
        }

        .sidebar-mode .nc-post-card {
            padding: 10px;
        }

        .sidebar-mode .nc-post-image {
            height: 60px;
            /* –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ */
            margin-bottom: 8px;
        }

        .sidebar-mode .nc-post-title {
            font-size: 13px;
        }

        .sidebar-mode .nc-post-desc {
            display: block;
            /* –í–µ—Ä–Ω–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ */
            font-size: 9px;
            line-height: 1.1;
        }

        .nc-post-card {
            position: relative;
            background: #fff;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            height: 100%;
        }

        .nc-post-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: #CBD5E0;
        }

        /* –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç */
        .nc-post-card input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ: –í—ã–±—Ä–∞–Ω–æ */
        .nc-post-card:has(input:checked) {
            border-color: var(--nc-color-brand);
            background-color: rgba(32, 181, 185, 0.05);
            box-shadow: 0 4px 6px -1px rgba(32, 181, 185, 0.2);
        }

        /* –ì–∞–ª–æ—á–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
        .nc-post-card:has(input:checked)::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 16px;
            height: 16px;
            background: var(--nc-color-brand);
            color: white;
            border-radius: 50%;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nc-post-image {
            width: 100%;
            height: 100px;
            object-fit: contain;
            margin-bottom: 12px;
        }

        .nc-post-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--nc-color-text);
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .nc-post-desc {
            font-size: 11px;
            color: var(--nc-color-text-light);
            line-height: 1.3;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ü–≤–µ—Ç–æ–≤ –≤ 3D */
        .color-controls-3d {
            position: absolute;
            left: 20px;
            bottom: 20px;
            top: auto;
            transform: none;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
        }

        .color-group-3d {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .color-group-title {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            text-align: center;
        }

        .color-buttons-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 160px;
        }

        .color-btn-3d {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
            position: relative;
        }

        .color-btn-3d:hover {
            transform: scale(1.15);
            z-index: 10;
        }

        .color-btn-3d.active {
            border-color: #20B5B9;
            transform: scale(1.1);
        }

        /* Tooltip */
        .color-btn-3d:hover::after {
            content: attr(title);
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: #333;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            margin-left: 10px;
            pointer-events: none;
        }

        /* 3D Roof Type Buttons */
        .roof-type-controls-3d {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .roof-type-card {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            padding: 12px 16px;
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            width: auto;
            min-width: 180px;
        }

        .roof-type-card:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateX(4px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .roof-type-card.active {
            border-color: #20B5B9;
            background: white;
            box-shadow: 0 4px 12px rgba(32, 181, 185, 0.2);
        }

        .roof-type-card svg {
            width: 36px;
            height: 36px;
            flex-shrink: 0;
            fill: #718096;
            transition: fill 0.2s;
        }

        .roof-type-card:hover svg {
            fill: #4A5568;
        }

        .roof-type-card.active svg {
            fill: #20B5B9;
        }

        .roof-type-card .info {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .roof-type-card .title {
            font-weight: 700;
            font-size: 14px;
            color: #2D3748;
            margin-bottom: 2px;
        }

        .roof-type-card .desc {
            font-size: 11px;
            color: #718096;
            font-weight: 500;
        }

        /* === 3D Material Selector (Right Top Overlay) === */
        .roof-material-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .material-card {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            padding: 8px 12px;
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            width: 220px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .material-card:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateX(-4px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }

        .material-card.active {
            border-color: #20B5B9;
            background: white;
            box-shadow: 0 4px 12px rgba(32, 181, 185, 0.2);
        }

        /* –ì–∞–ª–æ—á–∫–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .material-card.active::after {
            content: '‚úì';
            position: absolute;
            top: -6px;
            right: -6px;
            width: 18px;
            height: 18px;
            background: #20B5B9;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .material-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            flex-shrink: 0;
            box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        /* --- CSS –¢–µ–∫—Å—Ç—É—Ä—ã –¥–ª—è –ø—Ä–µ–≤—å—é --- */
        .preview-shingle {
            background: repeating-linear-gradient(45deg, #6D4C41, #6D4C41 5px, #5D4037 5px, #5D4037 10px);
        }

        .preview-metal {
            background: linear-gradient(135deg, #78909C 0%, #B0BEC5 100%);
        }

        .preview-metal::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(90deg, transparent, transparent 8px, rgba(255, 255, 255, 0.3) 10px, transparent 12px);
        }

        .preview-profile {
            background: #546E7A;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 5px, rgba(0, 0, 0, 0.2) 5px, rgba(0, 0, 0, 0.2) 10px);
        }

        .preview-poly {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.6), rgba(33, 150, 243, 0.2));
            background-image: linear-gradient(rgba(255, 255, 255, 0.4) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.4) 1px, transparent 1px);
            background-size: 8px 8px;
        }

        .material-info {
            display: flex;
            flex-direction: column;
        }

        .material-title {
            font-weight: 700;
            font-size: 13px;
            color: #2D3748;
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .material-desc {
            font-size: 10px;
            color: #718096;
            line-height: 1.2;
            font-weight: 500;
        }
    </style>
</head>

<body>
    <!-- ‚úÖ –£–î–ê–õ–ï–ù–û: –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –º–∞–∫–µ—Ç (debug-layout) -->

    <!-- –û–†–ò–ì–ò–ù–ê–õ–¨–ù–´–ô –ú–ê–ö–ï–¢ -->
    <div style="display: block;">
        <div class="naves-calc-wrapper">
            <div class="naves-calc">
                <section id="nc-form"></section>
                <section class="naves-calc__view">
                    <div class="calculator-right-img-block">


                        <div class="images-block flex aic jcc posr bg-f9 round-10">
                            <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∫—Ä–æ–≤–ª–∏ (3D Overlay) -->
                            <div class="roof-type-controls-3d">
                                <div class="roof-type-card" data-value="var-1">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M21 6L3 13V16H21V6Z" />
                                        <rect x="3" y="18" width="18" height="2" fill-opacity="0.3" />
                                    </svg>
                                    <div class="info">
                                        <span class="title">–û–¥–Ω–æ—Å–∫–∞—Ç–Ω–∞—è</span>
                                        <span class="desc">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å</span>
                                    </div>
                                </div>
                                <div class="roof-type-card" data-value="var-3">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M12 3L2 12H22L12 3Z" />
                                        <path d="M12 3V12M7 12L12 7L17 12" stroke="white" stroke-width="1.5"
                                            fill="none" />
                                    </svg>
                                    <div class="info">
                                        <span class="title">W-–æ–±—Ä–∞–∑–Ω–∞—è</span>
                                        <span class="desc">–£—Å–∏–ª–µ–Ω–Ω–∞—è —Ñ–µ—Ä–º–∞</span>
                                    </div>
                                </div>
                                <div class="roof-type-card" data-value="var-2">
                                    <svg viewBox="0 0 24 24">
                                        <path d="M12 3L2 12H22L12 3Z" />
                                        <path d="M12 3V12 M7 12L12 6 M17 12L12 6" stroke="white" stroke-width="1.5"
                                            fill="none" />
                                    </svg>
                                    <div class="info">
                                        <span class="title">M-–æ–±—Ä–∞–∑–Ω–∞—è</span>
                                        <span class="desc">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤–∏–¥</span>
                                    </div>
                                </div>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∫—Ä–æ–≤–ª–∏ (3D Overlay) -->
                            <div class="roof-material-overlay">
                                <div class="material-card active" data-value="metal-grandline">
                                    <div class="material-preview preview-metal"></div>
                                    <div class="material-info">
                                        <span class="material-title">–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞</span>
                                        <span class="material-desc">–ö–ª–∞—Å—Å–∏–∫–∞ + —Å–Ω–µ–≥–æ–∑–∞–¥–µ—Ä–∂–∞—Ç–µ–ª–∏</span>
                                    </div>
                                </div>
                                <div class="material-card" data-value="shinglas-sonata">
                                    <div class="material-preview preview-shingle"></div>
                                    <div class="material-info">
                                        <span class="material-title">–ì–∏–±–∫–∞—è —á–µ—Ä–µ–ø–∏—Ü–∞</span>
                                        <span class="material-desc">–¢–∏—Ö–æ, –∞–∫–∫—É—Ä–∞—Ç–Ω–æ</span>
                                    </div>
                                </div>
                                <div class="material-card" data-value="profiled-gl35r">
                                    <div class="material-preview preview-profile"></div>
                                    <div class="material-info">
                                        <span class="material-title">–ü—Ä–æ—Ñ–Ω–∞—Å—Ç–∏–ª</span>
                                        <span class="material-desc">–ü—Ä–∞–∫—Ç–∏—á–Ω–æ –∏ –Ω–∞–¥—ë–∂–Ω–æ</span>
                                    </div>
                                </div>
                                <div class="material-card" data-value="polycarbonate-8mm">
                                    <div class="material-preview preview-poly"></div>
                                    <div class="material-info">
                                        <span class="material-title">–ü–æ–ª–∏–∫–∞—Ä–±–æ–Ω–∞—Ç</span>
                                        <span class="material-desc">–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å–≤–µ—Ç</span>
                                    </div>
                                </div>
                            </div>

                            <canvas id="nc-canvas" style="width: 100%; height: 100%;"></canvas>

                            <!-- –í—Ä–µ–∑–∫–∞ –ü–ê–ù–ï–õ–ò –¶–í–ï–¢–û–í –≤ 3D –æ–∫–Ω–æ -->
                            <div class="color-controls-3d">


                                <!-- –¶–≤–µ—Ç –∫—Ä–æ–≤–ª–∏ -->
                                <div class="color-group-3d">
                                    <div class="color-group-title">–¶–≤–µ—Ç –∫—Ä–æ–≤–ª–∏</div>
                                    <div class="color-buttons-row">
                                        <div class="color-btn-3d ${params.roofColor==='amber'?'active':''}"
                                            style="background: #CD7F32;" title="–Ø–Ω—Ç–∞—Ä—å" data-param="roofColor"
                                            data-value="amber"></div>
                                        <div class="color-btn-3d ${params.roofColor==='red'?'active':''}"
                                            style="background: #582329;" title="–ö—Ä–∞—Å–Ω—ã–π (RAL 3005)"
                                            data-param="roofColor" data-value="red"></div>
                                        <div class="color-btn-3d ${params.roofColor==='green'?'active':''}"
                                            style="background: #0F4336;" title="–ó–µ–ª–µ–Ω—ã–π (RAL 6005)"
                                            data-param="roofColor" data-value="green"></div>
                                        <div class="color-btn-3d ${params.roofColor==='blue'?'active':''}"
                                            style="background: #004D91;" title="–°–∏–Ω–∏–π (RAL 5005)" data-param="roofColor"
                                            data-value="blue"></div>
                                        <div class="color-btn-3d ${params.roofColor==='brown'?'active':''}"
                                            style="background: #45322E;" title="–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π (RAL 8017)"
                                            data-param="roofColor" data-value="brown"></div>
                                        <div class="color-btn-3d ${params.roofColor==='gray'?'active':''}"
                                            style="background: #474A51;" title="–°–µ—Ä—ã–π (RAL 7024)" data-param="roofColor"
                                            data-value="gray"></div>
                                    </div>
                                </div>

                                <div style="width: 100%; height: 1px; background: #eee; margin: 5px 0;"></div>

                                <!-- –¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞ -->
                                <div class="color-group-3d">
                                    <div class="color-group-title">–¶–≤–µ—Ç –∫–∞—Ä–∫–∞—Å–∞</div>
                                    <div class="color-buttons-row">
                                        <div class="color-btn-3d ${params.frameColoring==='no-coloring'?'active':''}"
                                            style="background: #E6D0A5;" title="–ë–µ–∑ –æ–∫—Ä–∞—Å–∞ (–°–æ—Å–Ω–∞)"
                                            data-param="frameColoring" data-value="no-coloring"></div>
                                        <div class="color-btn-3d ${params.frameColoring==='neomid'?'active':''}"
                                            style="background: #D4C179;" title="Neomid (–ü—Ä–æ–ø–∏—Ç–∫–∞)"
                                            data-param="frameColoring" data-value="neomid"></div>
                                        <div class="color-btn-3d ${params.frameColoring==='texturol-landscape'?'active':''}"
                                            style="background: #8D6E63;" title="Texturol Landscape"
                                            data-param="frameColoring" data-value="texturol-landscape"></div>
                                        <div class="color-btn-3d ${params.frameColoring==='texturol-country'?'active':''}"
                                            style="background: #4E342E;" title="Texturol Country"
                                            data-param="frameColoring" data-value="texturol-country"></div>
                                        <div class="color-btn-3d ${params.frameColoring==='olsta'?'active':''}"
                                            style="background: #A1887F;" title="Olsta" data-param="frameColoring"
                                            data-value="olsta"></div>
                                        <div class="color-btn-3d ${params.frameColoring==='tikkurila'?'active':''}"
                                            style="background: #F0F0F0; border: 1px solid #ddd;"
                                            title="Tikkurila (–ë–µ–ª—ã–π)" data-param="frameColoring" data-value="tikkurila">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∞–º–∏ —É–¥–∞–ª–µ–Ω—ã -->
                        </div>

                        <div class="path-bottom flex aic jcsb fz18 fz11m fw500">
                            <div class="link-360">
                                üîÑ –ó–∞–∂–º–∏—Ç–µ –ª–µ–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è, –∫–æ–ª–µ—Å–∏–∫–æ –¥–ª—è –∑—É–º–∞
                            </div>
                            <a href="#smeta" class="scroll-link red lh110 hide_992">–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å–º–µ—Ç–∞</a>
                        </div>
                    </div>
                    <div id="nc-summary"></div>
                </section>
            </div>

            <!-- –£—Ç–æ—á–Ω–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ MVP) -->
            <div class="design-refinement-container"></div>

            <!-- –£—Ç–æ—á–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞—Ä–∫–∞—Å–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ MVP) -->
            <div class="frame-params-refinement-container"></div>

            <!-- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–≤–µ—Å–∞ -->
            <section class="specification" id="smeta">
                <h2>—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–≤–µ—Å–∞</h2>
                <div class="mb-30">
                    <dl>
                        <dt class="flex aic f2 pointer">
                            <div class="num">01.</div>
                            <div class="name">–æ–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
                            <div class="arrow">‚ñº</div>
                        </dt>
                        <dd>
                            <ul>
                                <li>
                                    <div class="num">1.1</div>
                                    <div class="parameter">–¢–∏–ø –Ω–∞–≤–µ—Å–∞</div>
                                    <div class="value" id="specRoofType">–î–≤—É—Å–∫–∞—Ç–Ω—ã–π</div>
                                </li>
                                <li>
                                    <div class="num">1.2</div>
                                    <div class="parameter">–ú–∞—Ç–µ—Ä–∏–∞–ª –∫–∞—Ä–∫–∞—Å–∞</div>
                                    <div class="value" id="specFrameMaterial">–°–æ—Å–Ω–∞</div>
                                </li>
                                <li>
                                    <div class="num">1.3</div>
                                    <div class="parameter">–ú–∞—Ç–µ—Ä–∏–∞–ª –∫—Ä–æ–≤–ª–∏</div>
                                    <div class="value" id="specRoofingMaterial">–ú–µ—Ç–∞–ª–ª–æ—á–µ—Ä–µ–ø–∏—Ü–∞</div>
                                </li>
                                <li>
                                    <div class="num">1.4</div>
                                    <div class="parameter">–¶–≤–µ—Ç –∫—Ä–æ–≤–ª–∏</div>
                                    <div class="value" id="specRoofColor">–Ø–Ω—Ç–∞—Ä—å</div>
                                </li>
                                <li>
                                    <div class="num">1.5</div>
                                    <div class="parameter">–ü–ª–æ—â–∞–¥—å</div>
                                    <div class="value" id="specArea">66.0–º¬≤</div>
                                </li>
                                <li>
                                    <div class="num">1.6</div>
                                    <div class="parameter">–®–∏—Ä–∏–Ω–∞ –ø–æ –æ—Å—è–º</div>
                                    <div class="value" id="specWidth">6 000 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">1.7</div>
                                    <div class="parameter">–î–ª–∏–Ω–∞ –ø–æ —Ä–∏–≥–µ–ª—é</div>
                                    <div class="value" id="specLength">11 400 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">1.8</div>
                                    <div class="parameter">–í—ã—Å–æ—Ç–∞ —Å—Ç–æ–ª–±–æ–≤</div>
                                    <div class="value" id="specHeight">3 000 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">1.9</div>
                                    <div class="parameter">–í—ã—Å–æ—Ç–∞ —Å–∫–∞—Ç–æ–≤</div>
                                    <div class="value" id="specRoofHeight">1 500 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">1.10</div>
                                    <div class="parameter">–®–∞–≥ —Å—Ç–æ–ª–±–æ–≤</div>
                                    <div class="value" id="specPostSpacing">2 500 –º–º</div>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                    <dl>
                        <dt class="flex aic f2 pointer">
                            <div class="num">02.</div>
                            <div class="name">—Å—Ç–æ–ª–±—ã</div>
                            <div class="arrow">‚ñº</div>
                        </dt>
                        <dd>
                            <ul>
                                <li>
                                    <div class="num">2.1</div>
                                    <div class="parameter">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±–æ–≤</div>
                                    <div class="value" id="specPosts">10 —à—Ç.</div>
                                </li>
                                <li>
                                    <div class="num">2.2</div>
                                    <div class="parameter">–¢–∏–ø —Å—Ç–æ–ª–±–æ–≤</div>
                                    <div class="value" id="specPostType">–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –±—Ä—É—Å</div>
                                </li>
                                <li>
                                    <div class="num">2.3</div>
                                    <div class="parameter">–ú–∞—Ç–µ—Ä–∏–∞–ª —Å—Ç–æ–ª–±–æ–≤</div>
                                    <div class="value" id="specPostMaterial">–°–æ—Å–Ω–∞</div>
                                </li>
                                <li>
                                    <div class="num">2.4</div>
                                    <div class="parameter">–í—ã—Å–æ—Ç–∞ —Å—Ç–æ–ª–±–æ–≤ —Å–ª–µ–≤–∞</div>
                                    <div class="value" id="specHeightLeft">3 000 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">2.5</div>
                                    <div class="parameter">–í—ã—Å–æ—Ç–∞ —Å—Ç–æ–ª–±–æ–≤ —Å–ø—Ä–∞–≤–∞</div>
                                    <div class="value" id="specHeightRight">3 000 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">2.6</div>
                                    <div class="parameter">–°–µ—á–µ–Ω–∏–µ —Å—Ç–æ–ª–±–æ–≤</div>
                                    <div class="value" id="specPostSection">150 x 150 –º–º</div>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                    <dl>
                        <dt class="flex aic f2 pointer">
                            <div class="num">03.</div>
                            <div class="name">–§–µ—Ä–º—ã</div>
                            <div class="arrow">‚ñº</div>
                        </dt>
                        <dd>
                            <ul>
                                <li>
                                    <div class="num">3.1</div>
                                    <div class="parameter">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–µ—Ä–º</div>
                                    <div class="value" id="specFarms">5 —à—Ç.</div>
                                </li>
                                <li>
                                    <div class="num">3.2</div>
                                    <div class="parameter">–ú–∞—Ç–µ—Ä–∏–∞–ª —Ñ–µ—Ä–º</div>
                                    <div class="value" id="specTrussMaterial">–°—Ç—Ä–æ–≥–∞–Ω–∞—è –¥–æ—Å–∫–∞ 45√ó190 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">3.3</div>
                                    <div class="parameter">–î–ª–∏–Ω–∞ —Ñ–µ—Ä–º—ã</div>
                                    <div class="value" id="specFarmLength">6 000 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">3.4</div>
                                    <div class="parameter">–®–∞–≥ —Ñ–µ—Ä–º</div>
                                    <div class="value" id="specTrussSpacing">2 500 –º–º</div>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                    <dl>
                        <dt class="flex aic f2 pointer">
                            <div class="num">04.</div>
                            <div class="name">–†–∞—Å–∫–æ—Å—ã</div>
                            <div class="arrow">‚ñº</div>
                        </dt>
                        <dd>
                            <ul>
                                <li>
                                    <div class="num">4.1</div>
                                    <div class="parameter">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—Å–∫–æ—Å–æ–≤</div>
                                    <div class="value" id="specBraces">20 —à—Ç.</div>
                                </li>
                                <li>
                                    <div class="num">4.2</div>
                                    <div class="parameter">–¢–∏–ø —Ä–∞—Å–∫–æ—Å–æ–≤</div>
                                    <div class="value" id="specBraceType">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</div>
                                </li>
                                <li>
                                    <div class="num">4.3</div>
                                    <div class="parameter">–ú–∞—Ç–µ—Ä–∏–∞–ª —Ä–∞—Å–∫–æ—Å–æ–≤</div>
                                    <div class="value" id="specBraceMaterial">–°–æ—Å–Ω–∞</div>
                                </li>
                                <li>
                                    <div class="num">4.4</div>
                                    <div class="parameter">–°–µ—á–µ–Ω–∏–µ —Ä–∞—Å–∫–æ—Å–æ–≤</div>
                                    <div class="value">50 x 100 –º–º</div>
                                </li>
                                <li>
                                    <div class="num">4.5</div>
                                    <div class="parameter">–î–ª–∏–Ω–∞ —Ä–∞—Å–∫–æ—Å–æ–≤</div>
                                    <div class="value">1 500 –º–º</div>
                                </li>
                            </ul>
                        </dd>
                    </dl>
                </div>
            </section>
        </div>

        <!-- ====================================== -->
        <!-- MVP ARCHITECTURE SCRIPTS              -->
        <!-- ====================================== -->

        <!-- –ú–æ–¥—É–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ -->
        <script src="assets/js/storage-manager.js"></script>
        <script src="assets/js/order-manager.js"></script>
        <script src="assets/js/pdf-export.js"></script>

        <!-- MVP Core Components -->
        <script src="assets/js/mvp/CanopyModel.js"></script>
        <script src="assets/js/mvp/CanopyView.js"></script>

        <!-- Three.js Dependencies -->
        <script src="assets/libs/three/three.min.js"></script>
        <script src="assets/libs/three/OrbitControls-wrapper.js"></script>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ THREE.js –±–∏–±–ª–∏–æ—Ç–µ–∫ -->
        <script>
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ THREE.js –±–∏–±–ª–∏–æ—Ç–µ–∫:');
            console.log('  THREE:', typeof THREE !== 'undefined' ? '‚úÖ' : '‚ùå');
            console.log('  THREE.OrbitControls:', typeof THREE.OrbitControls !== 'undefined' ? '‚úÖ' : '‚ùå');
            console.log('‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ THREE.js –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ');
        </script>

        <!-- System of parametric roofing (after THREE.js) -->
        <script src="assets/js/mvp/RoofSystem.js?v=2"></script>

        <!-- Loading braces from code -->
        <script type="module" src="assets/js/braces-code-loader.js"></script>

        <!-- MVP Renderer & Presenter -->
        <!-- LogoManager - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ—Ç–∏–ø–æ–º -->
        <script src="assets/js/mvp/LogoManager.js?v=9"></script>

        <!-- Use ES module version of V3 Renderer -->
        <script src="assets/js/mvp/CanopyRendererV3.js?v=12"></script>
        <script src="assets/js/mvp/CanopyPresenter.js"></script>

        <!-- –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –î–û app.js) -->
        <script>
            // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            window.toggleFullscreen3D = function () {
                const imagesBlock = document.querySelector('.images-block');
                const calculatorBlock = document.querySelector('.calculator-right-img-block');
                const canvas = document.querySelector('#nc-canvas');
                const body = document.body;

                if (!canvas || !imagesBlock || !calculatorBlock) {
                    console.warn('‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç—ã 3D –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                    return;
                }

                const isFullscreen = body.classList.contains('fullscreen-3d');

                if (!isFullscreen) {
                    // –í—Ö–æ–¥ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
                    body.classList.add('fullscreen-3d');
                    imagesBlock.classList.add('fullscreen-mode');
                    calculatorBlock.classList.add('fullscreen-mode');
                    canvas.style.width = '100vw';
                    canvas.style.height = '100vh';
                } else {
                    // –í—ã—Ö–æ–¥ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
                    body.classList.remove('fullscreen-3d');
                    imagesBlock.classList.remove('fullscreen-mode');
                    calculatorBlock.classList.remove('fullscreen-mode');
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã 3D —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è CSS
                if (window.CanopyApp && window.CanopyApp.renderer) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    requestAnimationFrame(() => {
                        setTimeout(() => {
                            const renderer = window.CanopyApp.renderer;

                            // –í—ã–∑—ã–≤–∞–µ–º handleResize –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã –∏ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
                            if (renderer.handleResize) {
                                renderer.handleResize();
                            }

                            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
                            if (renderer.renderer && canvas) {
                                const container = canvas.parentElement;
                                if (container) {
                                    const width = container.clientWidth || window.innerWidth;
                                    const height = container.clientHeight || window.innerHeight;

                                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä—ã —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
                                    renderer.renderer.setSize(width, height, false);

                                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–º–µ—Ä—É
                                    if (renderer.camera) {
                                        renderer.camera.aspect = width / height;
                                        renderer.camera.updateProjectionMatrix();
                                    }

                                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ü–µ–Ω—É
                                    if (renderer.scene && renderer.camera) {
                                        renderer.renderer.render(renderer.scene, renderer.camera);
                                    }

                                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
                                    if (renderer.needsRender !== undefined) {
                                        renderer.needsRender = true;
                                    }
                                }
                            }
                        }, 100);
                    });
                }
            };
        </script>

        <!-- MVP App Initialization -->
        <script src="assets/js/mvp/app_v2.js?v=2"></script>

        <!-- üöÄ Braces Code Loader - –∑–∞–º–µ–Ω–∞ GLB –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –∫–æ–ø–∏–∏ -->
        <script type="module" src="assets/js/braces-code-loader.js"></script>

        <script>
            window.addEventListener('DOMContentLoaded', () => {
                // MVP –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ app.js
                // –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —á–µ—Ä–µ–∑ window.CanopyApp

                // –°–æ–∑–¥–∞–µ–º –æ–±–µ—Ä—Ç–∫—É –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
                setTimeout(() => {
                    if (window.CanopyApp && window.CanopyApp.renderer) {
                        window.NavesCalc = {
                            camera: window.CanopyApp.renderer.camera,
                            controls: window.CanopyApp.renderer.controls,
                            renderer: window.CanopyApp.renderer.renderer,
                            scene: window.CanopyApp.renderer.scene,
                            params: window.CanopyApp.model.params,
                            currentPostSpacing: window.CanopyApp.model.params.postSpacing / 10,
                            needsRender: true,

                            update3DModel: () => {
                                window.CanopyApp.presenter.update3DModelImmediately();
                            },
                            calculateTotal: () => {
                                window.CanopyApp.presenter.calculateAndUpdate();
                            },
                            updateSpecification: () => {
                                window.CanopyApp.presenter.calculateAndUpdate();
                            },
                            updateParam: (key, value) => {
                                window.CanopyApp.model.updateParam(key, value);
                                window.CanopyApp.presenter.calculateAndUpdate();
                                window.CanopyApp.presenter.update3DModelDebounced();
                            },
                            setQualityLevelManual: (level) => {
                                if (window.CanopyApp.renderer.setQualityLevel) {
                                    window.CanopyApp.renderer.setQualityLevel(level);
                                }
                            },
                            qualityLevel: 'high'
                        };
                        console.log('‚úÖ –û–±–µ—Ä—Ç–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ window.NavesCalc —Å–æ–∑–¥–∞–Ω–∞');
                    }
                }, 500);

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ (3D Overlay)
                setTimeout(() => {
                    const colorBtns = document.querySelectorAll('.color-btn-3d');
                    console.log('üé® –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —Ü–≤–µ—Ç–∞. –ù–∞–π–¥–µ–Ω–æ:', colorBtns.length);

                    colorBtns.forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            // –ï—Å–ª–∏ –∫–ª–∏–∫ –ø–æ –ø—Å–µ–≤–¥–æ—ç–ª–µ–º–µ–Ω—Ç—É –∏–ª–∏ –≤–Ω—É—Ç—Ä–∏, –Ω–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É
                            const target = e.target.closest('.color-btn-3d');
                            if (!target) return;

                            const param = target.dataset.param;
                            const value = target.dataset.value;

                            console.log(`üé® –ö–ª–∏–∫ –ø–æ —Ü–≤–µ—Ç—É: ${param} = ${value}`);

                            // –°–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å —Å–æ—Å–µ–¥–µ–π
                            const row = target.closest('.color-buttons-row');
                            if (row) {
                                row.querySelectorAll('.color-btn-3d').forEach(b => b.classList.remove('active'));
                            }

                            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é
                            target.classList.add('active');

                            // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–µ–ª—å
                            if (window.NavesCalc && window.NavesCalc.updateParam) {
                                window.NavesCalc.updateParam(param, value);
                            } else {
                                console.warn('NavesCalc –Ω–µ –≥–æ—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞');
                            }
                        });
                    });
                }, 1000); // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ DOM

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤
                // –¢–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ MVP –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ CanopyView.js
                // initCollapsibleBlocks(); // –û—Ç–∫–ª—é—á–µ–Ω–æ - —Ç–µ–ø–µ—Ä—å —á–µ—Ä–µ–∑ MVP

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
                initRoofButtons();
                initSliders();

                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                syncDefaultValues();

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—â–∏–Ω—É —Å—Ç–æ–ª–±–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ—á–µ–Ω–∏—è
                setTimeout(() => {
                    updatePostThickness();
                }, 100);

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä–æ–π
                setTimeout(() => {
                    initCameraControls();
                }, 600);

                // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
                PerformanceOptimizer.optimizeForDevice();

                console.log('‚úÖ MVP Architecture –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
                console.log('üì¶ –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ window.CanopyApp');
            });

            // –§—É–Ω–∫—Ü–∏—è initCollapsibleBlocks –æ—Ç–∫–ª—é—á–µ–Ω–∞ - —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ MVP –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ CanopyView.js
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–µ–∫—Ü–∏–π "—É—Ç–æ—á–Ω–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞" –∏ "—É—Ç–æ—á–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞—Ä–∫–∞—Å–∞" 
            // —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥–∞—Ö bindDesignRefinementEvents() –∏ bindFrameParamsRefinementEvents()

            // –°–∏—Å—Ç–µ–º–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            const PerformanceOptimizer = {
                debounceTimers: new Map(),
                updateQueue: new Set(),

                // Debounced –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–æ–≤
                debouncedUpdate(sliderId, callback, delay = 300) {
                    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
                    if (this.debounceTimers.has(sliderId)) {
                        clearTimeout(this.debounceTimers.get(sliderId));
                    }

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
                    const timer = setTimeout(() => {
                        try {
                            callback();
                            this.debounceTimers.delete(sliderId);
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –≤ debounced –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', error);
                        }
                    }, delay);

                    this.debounceTimers.set(sliderId, timer);
                },

                // Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                batchUpdate(updateFn) {
                    this.updateQueue.add(updateFn);

                    // –í—ã–ø–æ–ª–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –∫–∞–¥—Ä–µ
                    requestAnimationFrame(() => {
                        this.updateQueue.forEach(fn => {
                            try {
                                fn();
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ –≤ batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', error);
                            }
                        });
                        this.updateQueue.clear();
                    });
                },

                // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                optimizeForDevice() {
                    const isLowEnd = navigator.hardwareConcurrency <= 2 ||
                        navigator.deviceMemory <= 4 ||
                        /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

                    if (isLowEnd) {
                        console.log('–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å–ª–∞–±–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –ø—Ä–∏–º–µ–Ω—è–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏...');

                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                        if (window.NavesCalc) {
                            window.NavesCalc.qualityLevel = 'low';
                            window.NavesCalc.setQualityLevelManual('low');
                        }

                        // –£–º–µ–Ω—å—à–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
                        this.debounceDelay = 500;

                        // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
                        const panel = document.getElementById('performance-panel');
                        if (panel && window.innerWidth < 768) {
                            panel.classList.add('hidden');
                        }
                    }

                    return isLowEnd;
                }
            };

            function initSliders() {
                const sliders = document.querySelectorAll('.slider');

                sliders.forEach(slider => {
                    slider.addEventListener('input', function () {
                        const valueSpan = this.closest('.has-slider').querySelector('.value span');
                        if (!valueSpan) return;

                        // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        let displayValue = this.value;

                        if (this.id === 'columnStep') {
                            displayValue = (this.value / 10).toFixed(1);
                        }

                        valueSpan.textContent = displayValue;

                        // Debounced –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 3D –º–æ–¥–µ–ª–∏
                        PerformanceOptimizer.debouncedUpdate(this.id, () => {
                            try {
                                updateSliderValue(this);
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª–∞–π–¥–µ—Ä–∞:', error);
                                showError('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞');
                            }
                        }, PerformanceOptimizer.debounceDelay || 300);
                    });
                });
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
            function updateSliderValue(slider) {
                if (!window.NavesCalc) {
                    console.warn('NavesCalc –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                    return;
                }

                const value = parseInt(slider.value);

                // –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
                if (isNaN(value) || value < 0) {
                    console.error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–∞:', slider.value);
                    return;
                }

                try {
                    switch (slider.id) {
                        case 'columnStep':
                            window.NavesCalc.currentPostSpacing = value / 10;
                            break;
                        case 'frontBeamExtension':
                            window.NavesCalc.params.frontBeamExtension = value;
                            break;
                        case 'backBeamExtension':
                            window.NavesCalc.params.backBeamExtension = value;
                            break;
                    }

                    // Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                    PerformanceOptimizer.batchUpdate(() => {
                        if (window.NavesCalc.update3DModel) {
                            window.NavesCalc.update3DModel();
                        }
                        if (window.NavesCalc.calculateTotal) {
                            window.NavesCalc.calculateTotal();
                        }
                        if (window.NavesCalc.updateSpecification) {
                            window.NavesCalc.updateSpecification();
                        }
                    });

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:', error);
                    showError('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞');
                }
            }

            // –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
            function showError(message) {
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                const notification = document.createElement('div');
                notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff4444;
                color: white;
                padding: 10px 15px;
                border-radius: 5px;
                z-index: 10000;
                font-size: 14px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            `;
                notification.textContent = message;

                document.body.appendChild(notification);

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }

            // –§—É–Ω–∫—Ü–∏—è initSelects –æ—Ç–∫–ª—é—á–µ–Ω–∞ - —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ MVP –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ CanopyView.js
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ bindFormEvents() –∏ bindFrameParamsRefinementEvents()

            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—â–∏–Ω—ã —Å—Ç–æ–ª–±–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ—á–µ–Ω–∏—è —Å—Ç–æ–ª–±–æ–≤
            function updatePostThickness() {
                if (!window.NavesCalc || !window.NavesCalc.params) return;

                const postType = window.NavesCalc.params.postType;
                const postMaterial = window.NavesCalc.params.postMaterial;

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—â–∏–Ω—É –¥–ª—è —Å—Ç–æ–ª–±–æ–≤ —Å –ø–æ–¥–ø—è—Ç–Ω–∏–∫–æ–º –∏–ª–∏ –∫–∞–ø–∏—Ç–µ–ª—å—é
                if (postMaterial) {
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –∏–∑ –∑–Ω–∞—á–µ–Ω–∏—è postMaterial (–Ω–∞–ø—Ä–∏–º–µ—Ä, "glued-150x150" -> 150)
                    const sizeMatch = postMaterial.match(/(\d+)x(\d+)/);
                    if (sizeMatch) {
                        const width = parseFloat(sizeMatch[1]);
                        const height = parseFloat(sizeMatch[2]);

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ NavesCalc
                        window.NavesCalc.params.postWidth = width / 1000; // –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–µ—Ç—Ä—ã
                        window.NavesCalc.params.postDepth = height / 1000; // –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–µ—Ç—Ä—ã

                        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–ø—è—Ç–Ω–∏–∫–∞ (–¥–ª—è var-5, var-4)
                        const footOverhang = 40; // –≤—ã—Å—Ç—É–ø —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –≤ –º–º
                        const footThickness = 40; // —Ç–æ–ª—â–∏–Ω–∞ –ø—è—Ç–∫–∏ –≤ –º–º

                        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ø–∏—Ç–µ–ª–∏ (–¥–ª—è var-3, var-4)
                        const capitalOverhang = 50; // —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –≤ –º–º
                        const capitalThickness = 80; // –≤—ã—Å–æ—Ç–∞ –∫–∞–ø–∏—Ç–µ–ª–∏ –≤ –º–º

                        if (postType === 'var-5' || postType === 'var-4') {
                            window.NavesCalc.params.postFootWidth = (width + footOverhang * 2) / 1000; // –≤ –º–µ—Ç—Ä–∞—Ö
                            window.NavesCalc.params.postFootDepth = (height + footOverhang * 2) / 1000; // –≤ –º–µ—Ç—Ä–∞—Ö
                            window.NavesCalc.params.postFootHeight = footThickness / 1000; // –≤ –º–µ—Ç—Ä–∞—Ö
                            console.log(`–ü–æ–¥–ø—è—Ç–Ω–∏–∫ —Å—Ç–æ–ª–±–∞ ${postType}: ${width + footOverhang * 2}x${height + footOverhang * 2}x${footThickness} –º–º`);
                        }

                        if (postType === 'var-3' || postType === 'var-4') {
                            window.NavesCalc.params.postCapitalWidth = (width + capitalOverhang * 2) / 1000; // –≤ –º–µ—Ç—Ä–∞—Ö
                            window.NavesCalc.params.postCapitalDepth = (height + capitalOverhang * 2) / 1000; // –≤ –º–µ—Ç—Ä–∞—Ö
                            window.NavesCalc.params.postCapitalHeight = capitalThickness / 1000; // –≤ –º–µ—Ç—Ä–∞—Ö
                            console.log(`–ö–∞–ø–∏—Ç–µ–ª—å —Å—Ç–æ–ª–±–∞ ${postType}: ${width + capitalOverhang * 2}x${height + capitalOverhang * 2}x${capitalThickness} –º–º`);
                        }

                        console.log(`–°–µ—á–µ–Ω–∏–µ —Å—Ç–æ–ª–±–∞ ${postType}: ${width}x${height} –º–º`);
                    }
                }
            }

            // –§—É–Ω–∫—Ü–∏—è initRadioButtons –æ—Ç–∫–ª—é—á–µ–Ω–∞ - —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ MVP –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ CanopyView.js
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ —Å—Ç–æ–ª–±–æ–≤ —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –≤ –º–µ—Ç–æ–¥–µ bindDesignRefinementEvents()

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –∫—Ä–æ–≤–ª–∏ (3D Overlay)
            function initRoofButtons() {
                const roofBtns = document.querySelectorAll('.roof-type-card');

                roofBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        // –ù–∞—Ö–æ–¥–∏–º –∫–∞—Ä—Ç–æ—á–∫—É
                        const target = e.target.closest('.roof-type-card');
                        if (!target) return;

                        const value = target.dataset.value;

                        // –°–Ω–∏–º–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                        roofBtns.forEach(b => b.classList.remove('active'));
                        target.classList.add('active');

                        console.log('üè† –í—ã–±—Ä–∞–Ω —Ç–∏–ø –∫—Ä–æ–≤–ª–∏ (3D):', value);

                        if (window.NavesCalc && window.NavesCalc.updateParam) {
                            window.NavesCalc.updateParam('roofType', value);
                        }
                    });
                });

                // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑–≤–Ω–µ
                window.updateRoofTypeUI = function (type) {
                    roofBtns.forEach(b => {
                        if (b.dataset.value === type) b.classList.add('active');
                        else b.classList.remove('active');
                    });
                };

                // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∫—Ä–æ–≤–ª–∏ (3D Overlay) ---
                const materialCards = document.querySelectorAll('.material-card');

                // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                window.updateRoofingMaterialUI = function (value) {
                    materialCards.forEach(card => {
                        if (card.dataset.value === value) {
                            card.classList.add('active');
                        } else {
                            card.classList.remove('active');
                        }
                    });
                };

                materialCards.forEach(card => {
                    card.addEventListener('click', () => {
                        const value = card.dataset.value;

                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ä–∞–∑—É
                        window.updateRoofingMaterialUI(value);

                        console.log('üèó –í—ã–±—Ä–∞–Ω –º–∞—Ç–µ—Ä–∏–∞–ª –∫—Ä–æ–≤–ª–∏ (3D):', value);

                        // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–µ–ª—å
                        if (window.NavesCalc && window.NavesCalc.updateParam) {
                            window.NavesCalc.updateParam('roofingMaterial', value);
                        }
                    });
                });
            }

            function syncDefaultValues() {
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å HTML —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
                if (window.NavesCalc) {
                    const params = window.NavesCalc.params;

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤
                    const frameMaterialSelect = document.getElementById('frameMaterial');
                    if (frameMaterialSelect) {
                        frameMaterialSelect.value = params.frameMaterial || 'pine';
                    }

                    const postMaterialSelect = document.getElementById('postMaterial');
                    if (postMaterialSelect) {
                        postMaterialSelect.value = params.postMaterial || 'glued-150x150';
                    }

                    const trussMaterialSelect = document.getElementById('trussMaterial');
                    if (trussMaterialSelect) {
                        trussMaterialSelect.value = params.trussMaterial || 'planed-45x190';
                    }

                    const braceTypeSelect = document.getElementById('braceType');
                    if (braceTypeSelect) {
                        braceTypeSelect.value = params.braceType || 'var-1';
                    }

                    const frameColoringSelect = document.getElementById('frameColoring');
                    if (frameColoringSelect) {
                        frameColoringSelect.value = params.frameColoring || 'no-coloring';
                    }

                    const roofingMaterialSelect = document.getElementById('roofingMaterial');
                    if (roofingMaterialSelect) {
                        roofingMaterialSelect.value = params.roofingMaterial || 'metal-grandline';
                    }

                    const roofColorSelect = document.getElementById('roofColor');
                    if (roofColorSelect) {
                        roofColorSelect.value = params.roofColor || 'amber';
                    }

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–æ–≤
                    const columnStepSlider = document.getElementById('columnStep');
                    if (columnStepSlider) {
                        columnStepSlider.value = (params.postSpacing || 25) * 10; // –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –¥–µ—Ü–∏–º–µ—Ç—Ä—ã
                        const valueSpan = columnStepSlider.closest('.has-slider').querySelector('.value span');
                        if (valueSpan) {
                            valueSpan.textContent = (params.postSpacing || 25) / 10;
                        }
                    }

                    const frontBeamExtensionSlider = document.getElementById('frontBeamExtension');
                    if (frontBeamExtensionSlider) {
                        frontBeamExtensionSlider.value = params.frontBeamExtension || 200;
                        const valueSpan = frontBeamExtensionSlider.closest('.has-slider').querySelector('.value span');
                        if (valueSpan) {
                            valueSpan.textContent = params.frontBeamExtension || 200;
                        }
                    }

                    const backBeamExtensionSlider = document.getElementById('backBeamExtension');
                    if (backBeamExtensionSlider) {
                        backBeamExtensionSlider.value = params.backBeamExtension || 200;
                        const valueSpan = backBeamExtensionSlider.closest('.has-slider').querySelector('.value span');
                        if (valueSpan) {
                            valueSpan.textContent = params.backBeamExtension || 200;
                        }
                    }

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∏–ø —Å—Ç–æ–ª–±–∞
                    const postType = params.postType || 'var-5';
                    const postRadio = document.getElementById(`type-stolbi-${postType}`);
                    if (postRadio) {
                        postRadio.checked = true;
                    }

                    // Sync 3D Roof Buttons
                    if (window.updateRoofTypeUI) {
                        window.updateRoofTypeUI(params.roofType || 'var-2');
                    }
                }
            }

            function initCameraControls() {
                // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—ã—à—å—é (OrbitControls)
            }

            const orderManager = new OrderManager('/api/orders'); // –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É API
            const pdfExporter = new PDFExporter();

            // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–∞
            function getCurrentCalculationData() {
                const params = window.NavesCalc ? window.NavesCalc.params : {};
                const totalPrice = document.getElementById('totalPrice')?.textContent || '0 ‚ÇΩ';

                return {
                    // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    length: params.length ? params.length / 10 : 0, // –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–µ—Ç—Ä—ã
                    width: params.width ? params.width / 10 : 0,
                    height: params.height ? params.height / 10 : 0,
                    roofHeight: params.roofHeight ? params.roofHeight / 10 : 0,
                    area: params.length && params.width ? (params.length * params.width / 100).toFixed(2) : 0,

                    // –¢–∏–ø—ã –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
                    roofType: params.roofType || 'var-2',
                    postType: params.postType || 'var-5',
                    braceType: params.braceType || 'var-1',
                    postMaterial: params.postMaterial || 'glued-150x150',
                    trussMaterial: params.trussMaterial || 'planed-45x190',
                    roofingMaterial: params.roofingMaterial || 'metal-grandline',
                    roofColor: params.roofColor || 'amber',
                    frameMaterial: params.frameMaterial || 'pine',
                    frameColoring: params.frameColoring || 'no-coloring',

                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
                    postSpacing: params.postSpacing ? params.postSpacing / 10 : 2.5,
                    frontBeamExtension: params.frontBeamExtension || 200,
                    backBeamExtension: params.backBeamExtension || 200,
                    mountingRequired: params.mountingRequired || 'yes',
                    distanceFromMKAD: params.distanceFromMKAD || 10,

                    // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
                    totalPrice: totalPrice,
                    timestamp: Date.now(),
                    date: new Date().toLocaleString('ru-RU')
                };
            }

            // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫–∞–∑–∞
            window.makeOrder = function () {
                try {
                    const calculationData = getCurrentCalculationData();
                    const orderForm = orderManager.createOrderForm(calculationData);
                    document.body.appendChild(orderForm);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                }
            };

            // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞
            window.saveCalculation = function () {
                try {
                    const calculationData = getCurrentCalculationData();

                    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
                    const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞:', `–ù–∞–≤–µ—Å ${calculationData.length}√ó${calculationData.width}–º`);

                    if (name !== null) { // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–∂–∞–ª "–û—Ç–º–µ–Ω–∞"
                        const calcId = storageManager.saveCalculation(calculationData, name || undefined);

                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
                        showNotification('‚úÖ –†–∞—Å—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');

                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏, –µ—Å–ª–∏ –ø–∞–Ω–µ–ª—å –æ—Ç–∫—Ä—ã—Ç–∞
                        updateHistoryPanel();
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–∞—Å—á–µ—Ç–∞:', error);
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–∞—Å—á–µ—Ç–∞', 'error');
                }
            };

            // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ PDF
            window.exportToPDF = function () {
                try {
                    const calculationData = getCurrentCalculationData();
                    const filename = `naves_${calculationData.length}x${calculationData.width}m_${Date.now()}.pdf`;

                    showNotification('‚è≥ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF...', 'info');

                    pdfExporter.exportToPDF(calculationData, filename).then(() => {
                        showNotification('‚úÖ PDF —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                    }).catch((error) => {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ PDF:', error);
                        showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF', 'error');
                    });
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ PDF:', error);
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ PDF', 'error');
                }
            };

            // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
            window.loadSavedCalculation = function (calcId) {
                try {
                    const calculationData = storageManager.loadCalculation(calcId);

                    if (calculationData && window.NavesCalc) {
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                        const params = calculationData;

                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
                        if (params.length) window.NavesCalc.updateParam('length', params.length * 10); // –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –¥–µ—Ü–∏–º–µ—Ç—Ä—ã
                        if (params.width) window.NavesCalc.updateParam('width', params.width * 10);
                        if (params.height) window.NavesCalc.updateParam('height', params.height * 10);
                        if (params.roofHeight) window.NavesCalc.updateParam('roofHeight', params.roofHeight * 10);
                        if (params.roofType) window.NavesCalc.updateParam('roofType', params.roofType);
                        if (params.postType) window.NavesCalc.updateParam('postType', params.postType);
                        if (params.braceType) window.NavesCalc.updateParam('braceType', params.braceType);
                        if (params.postMaterial) window.NavesCalc.updateParam('postMaterial', params.postMaterial);
                        if (params.trussMaterial) window.NavesCalc.updateParam('trussMaterial', params.trussMaterial);
                        if (params.roofingMaterial) window.NavesCalc.updateParam('roofingMaterial', params.roofingMaterial);
                        if (params.roofColor) window.NavesCalc.updateParam('roofColor', params.roofColor);

                        showNotification('‚úÖ –†–∞—Å—á–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
                    } else {
                        showNotification('‚ùå –†–∞—Å—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞—Å—á–µ—Ç–∞:', error);
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–∞—Å—á–µ—Ç–∞', 'error');
                }
            };

            // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞
            window.deleteSavedCalculation = function (calcId) {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–∞—Å—á–µ—Ç?')) {
                    try {
                        storageManager.deleteCalculation(calcId);
                        updateHistoryPanel();
                        showNotification('‚úÖ –†–∞—Å—á–µ—Ç —É–¥–∞–ª–µ–Ω', 'success');
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–∞—Å—á–µ—Ç–∞:', error);
                        showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏', 'error');
                    }
                }
            };

            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏
            window.updateHistoryPanel = function () {
                const historyPanel = document.getElementById('history-panel');
                if (!historyPanel) return;

                const calculations = storageManager.getAllCalculations();
                const historyList = historyPanel.querySelector('.history-list');

                if (!historyList) return;

                if (calculations.length === 0) {
                    historyList.innerHTML = '<p style="text-align: center; color: #999;">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤</p>';
                    return;
                }

                historyList.innerHTML = calculations.map(calc => `
                    <div class="history-item" data-id="${calc.id}">
                        <div class="history-item-header">
                            <strong>${calc.name}</strong>
                            <span class="history-item-date">${new Date(calc.timestamp).toLocaleString('ru-RU')}</span>
                        </div>
                        <div class="history-item-details">
                            ${calc.data.length}√ó${calc.data.width}–º, ${calc.data.totalPrice}
                        </div>
                        <div class="history-item-actions">
                            <button onclick="loadSavedCalculation('${calc.id}')" class="btn-small btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                            <button onclick="deleteSavedCalculation('${calc.id}')" class="btn-small btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `).join('');
            };

            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.textContent = message;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 25px;
                    background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
                    color: white;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 10000;
                    font-size: 14px;
                    animation: slideIn 0.3s ease;
                `;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            if (!document.getElementById('notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(400px); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(400px); opacity: 0; }
                    }
                    .history-item {
                        padding: 15px;
                        margin-bottom: 10px;
                        background: #f5f5f5;
                        border-radius: 8px;
                        border-left: 4px solid #20B5B9;
                    }
                    .history-item-header {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 8px;
                    }
                    .history-item-date {
                        color: #999;
                        font-size: 12px;
                    }
                    .history-item-details {
                        color: #666;
                        font-size: 14px;
                        margin-bottom: 10px;
                    }
                    .history-item-actions {
                        display: flex;
                        gap: 10px;
                    }
                    .btn-small {
                        padding: 6px 12px;
                        font-size: 12px;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                    }
                    .btn-primary {
                        background: #20B5B9;
                        color: white;
                    }
                    .btn-danger {
                        background: #f44336;
                        color: white;
                    }
                `;
                document.head.appendChild(style);
            }

            // –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è 3D –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            window.download3DImage = function () {
                if (window.NavesCalc && window.NavesCalc.renderer) {
                    // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                    const canvas = window.NavesCalc.renderer.domElement;
                    const link = document.createElement('a');
                    link.download = 'naves-3d-model.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                } else {
                    alert('3D –º–æ–¥–µ–ª—å –Ω–µ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                }
            };
        </script>

        <script>
            // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            window.PerformanceOptimizer = PerformanceOptimizer;

            // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø –û–¢–õ–ê–î–û–ß–ù–´–• –ö–ù–û–ü–û–ö
            function initDebugButtons() {
                console.log('=== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –û–¢–õ–ê–î–û–ß–ù–´–• –ö–ù–û–ü–û–ö ===');

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ —Å—Ç–æ–ª–±–æ–≤
                const debugStolbiRadios = document.querySelectorAll('input[name="type-stolbi"]');

                console.log('–ù–∞–π–¥–µ–Ω–æ –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫ —Å—Ç–æ–ª–±–æ–≤:', debugStolbiRadios.length);

                debugStolbiRadios.forEach(radio => {
                    radio.addEventListener('change', function () {
                        if (this.checked && window.NavesCalc) {
                            window.NavesCalc.params.postType = this.value;
                            console.log('–í—ã–±—Ä–∞–Ω —Ç–∏–ø —Å—Ç–æ–ª–±–∞ (–æ—Ç–ª–∞–¥–∫–∞):', this.value);
                            updatePostThickness(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—â–∏–Ω—É —Å—Ç–æ–ª–±–∞
                            window.NavesCalc.update3DModel();
                            window.NavesCalc.calculateTotal();
                            updateDebugInfo(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                        }
                    });
                });
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            function updateDebugInfo() {
                if (window.NavesCalc && window.NavesCalc.params) {
                    const price = window.NavesCalc.calculateTotal();
                    const dimensions = `${window.NavesCalc.params.length}x${window.NavesCalc.params.width} –º`;
                    const height = `${window.NavesCalc.params.height} –º`;

                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–¥–æ–ª—å–Ω—ã—Ö –±–∞–ª–æ–∫ (–º–∞—É—ç—Ä–ª–∞—Ç–æ–≤) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å—Ç–æ–ª–±–∞
                    const postType = window.NavesCalc.params.postType;
                    let longitudinalBeamSize;
                    if (postType === 'var-1' || postType === 'var-5') {
                        longitudinalBeamSize = '200√ó200 –º–º';
                    } else {
                        // –î–ª—è var-2, var-3, var-4 –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—á–µ–Ω–∏–µ —Å—Ç–æ–ª–±–æ–≤
                        const postMaterial = window.NavesCalc.params.postMaterial;
                        const match = postMaterial.match(/(\d+)x(\d+)/);
                        if (match) {
                            longitudinalBeamSize = `${match[1]}√ó${match[2]} –º–º`;
                        } else {
                            longitudinalBeamSize = '150√ó150 –º–º';
                        }
                    }

                    const priceEl = document.getElementById('debug-total-price');
                    const dimensionsEl = document.getElementById('debug-dimensions');
                    const heightEl = document.getElementById('debug-height');
                    const longitudinalBeamEl = document.getElementById('debug-longitudinal-beam');

                    if (priceEl) priceEl.textContent = price.toLocaleString() + ' ‚ÇΩ';
                    if (dimensionsEl) dimensionsEl.textContent = dimensions;
                    if (heightEl) heightEl.textContent = height;
                    if (longitudinalBeamEl) longitudinalBeamEl.textContent = longitudinalBeamSize;
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Å–µ—á–µ–Ω–∏—è –±–∞–ª–æ–∫
            window.selectBeam = function (element, value) {
                console.log('üî® –í—ã–±–æ—Ä —Å–µ—á–µ–Ω–∏—è –±–∞–ª–æ–∫:', value);

                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const allBeamItems = document.querySelectorAll('.debug-beam-item');
                allBeamItems.forEach(item => item.classList.remove('selected'));

                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                element.classList.add('selected');

                // –û—Ç–º–µ—á–∞–µ–º radio –∫–Ω–æ–ø–∫—É
                const radio = element.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ MVP Presenter (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±)
                if (window.CanopyApp && window.CanopyApp.presenter) {
                    console.log('‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CanopyApp.presenter');

                    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Presenter - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç Model, View –∏ Renderer
                    window.CanopyApp.presenter.onViewParamChanged('trussMaterial', value);

                    console.log('–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', window.CanopyApp.model.params);

                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–º –±–ª–æ–∫–µ
                    const beamSectionEl = document.getElementById('debug-beam-section');
                    const sizeText = element.querySelector('.debug-beam-size').textContent;
                    if (beamSectionEl) {
                        beamSectionEl.textContent = sizeText;
                    }

                    // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–π —Å–µ–ª–µ–∫—Ç –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                    const trussMaterialSelect = document.getElementById('trussMaterial');
                    if (trussMaterialSelect) {
                        trussMaterialSelect.value = value;
                    }

                    console.log('‚úÖ –°–µ—á–µ–Ω–∏–µ –±–∞–ª–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ MVP');
                } else {
                    console.error('‚ùå CanopyApp.presenter –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }

                console.log('–í—ã–±—Ä–∞–Ω–æ —Å–µ—á–µ–Ω–∏–µ –±–∞–ª–æ–∫ (trussMaterial):', value);
            };

            // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Ñ–µ—Ä–º (—Ñ–æ—Ä–º–∞ –∫—Ä–æ–≤–ª–∏)
            window.selectTrussType = function (element, value) {
                console.log('üèóÔ∏è –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ñ–µ—Ä–º:', value);

                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const allTrussItems = document.querySelectorAll('.debug-truss-item');
                allTrussItems.forEach(item => {
                    item.style.border = '2px solid #ddd';
                    item.style.background = 'transparent';
                });

                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                element.style.border = '2px solid #20B5B9';
                element.style.background = '#f0fbfb';

                // –û—Ç–º–µ—á–∞–µ–º radio –∫–Ω–æ–ø–∫—É
                const radio = element.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ MVP Presenter (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±)
                if (window.CanopyApp && window.CanopyApp.presenter) {
                    console.log('‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CanopyApp.presenter');

                    // –í–ê–ñ–ù–û: –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è roofType, –Ω–µ trussType!
                    window.CanopyApp.presenter.onViewParamChanged('roofType', value);

                    console.log('–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', window.CanopyApp.model.params);

                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ —Ç–∏–ø–∞ —Ñ–µ—Ä–º
                    const trussTypeRadios = document.querySelectorAll('input[name="type-karkas"]');
                    trussTypeRadios.forEach(radio => {
                        if (radio.value === value) {
                            radio.checked = true;
                        }
                    });

                    // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ MVP
                    const mvpRoofRadios = document.querySelectorAll('.nc-radio__input[name="type-karkas"]');
                    mvpRoofRadios.forEach(radio => {
                        if (radio.value === value) {
                            radio.checked = true;
                        }
                    });

                    console.log('‚úÖ –¢–∏–ø —Ñ–µ—Ä–º –æ–±–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ MVP');
                } else {
                    console.error('‚ùå CanopyApp.presenter –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }

                console.log('–í—ã–±—Ä–∞–Ω —Ç–∏–ø —Ñ–µ—Ä–º (roofType):', value);
            };

            // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Ä–∞—Å–∫–æ—Å–æ–≤
            window.selectBraceType = function (element, value) {
                console.log('üîß –í—ã–±–æ—Ä —Ä–∞—Å–∫–æ—Å–∞:', value);

                // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const allBraceItems = document.querySelectorAll('.debug-brace-item');
                allBraceItems.forEach(item => {
                    item.style.border = '2px solid #ddd';
                    item.style.background = 'transparent';
                });

                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                element.style.border = '2px solid #20B5B9';
                element.style.background = '#f0fbfb';

                // –û—Ç–º–µ—á–∞–µ–º radio –∫–Ω–æ–ø–∫—É
                const radio = element.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ MVP Presenter (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±)
                if (window.CanopyApp && window.CanopyApp.presenter) {
                    console.log('‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CanopyApp.presenter');

                    // –û–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ Presenter - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç Model, View –∏ Renderer
                    window.CanopyApp.presenter.onViewParamChanged('braceType', value);

                    console.log('–¢–µ–∫—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', window.CanopyApp.model.params);

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ MVP
                    const mvpBraceRadios = document.querySelectorAll('.nc-brace__input');
                    mvpBraceRadios.forEach(radio => {
                        if (radio.value === value) {
                            radio.checked = true;
                            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ MVP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                            const label = radio.nextElementSibling;
                            if (label) {
                                const allLabels = document.querySelectorAll('.nc-brace-item label');
                                allLabels.forEach(l => {
                                    l.style.borderColor = '#e2e8f0';
                                    l.style.background = '#f7fafc';
                                });
                                label.style.borderColor = '#20B5B9';
                                label.style.background = 'rgba(32, 181, 185, 0.1)';
                            }
                        }
                    });

                    console.log('‚úÖ –†–∞—Å–∫–æ—Å –æ–±–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ MVP');
                } else {
                    console.error('‚ùå CanopyApp.presenter –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }

                console.log('–í—ã–±—Ä–∞–Ω —Ç–∏–ø —Ä–∞—Å–∫–æ—Å–æ–≤:', value);
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ –±–∞–ª–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            function initBeamSelection() {
                const defaultBeamItem = document.querySelector('.debug-beam-item input[checked]');
                if (defaultBeamItem) {
                    const parent = defaultBeamItem.closest('.debug-beam-item');
                    if (parent) {
                        parent.classList.add('selected');
                    }
                }
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ä–∞—Å–∫–æ—Å–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            function initBraceSelection() {
                console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ä–∞—Å–∫–æ—Å–æ–≤...');

                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ç–∏–ø —Ä–∞—Å–∫–æ—Å–∞ –∏–∑ NavesCalc
                let currentBraceType = 'var-1'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                if (window.NavesCalc && window.NavesCalc.params && window.NavesCalc.params.braceType) {
                    currentBraceType = window.NavesCalc.params.braceType;
                }

                console.log('–¢–µ–∫—É—â–∏–π —Ç–∏–ø —Ä–∞—Å–∫–æ—Å–∞:', currentBraceType);

                // –í—ã–¥–µ–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –≤ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                const allBraceItems = document.querySelectorAll('.debug-brace-item');
                allBraceItems.forEach(item => {
                    const radio = item.querySelector('input[type="radio"]');
                    if (radio && radio.value === currentBraceType) {
                        item.style.border = '2px solid #20B5B9';
                        item.style.background = '#f0fbfb';
                        radio.checked = true;
                        console.log('‚úÖ –í—ã–¥–µ–ª–µ–Ω —Ä–∞—Å–∫–æ—Å:', currentBraceType);
                    } else {
                        item.style.border = '2px solid #ddd';
                        item.style.background = 'transparent';
                    }
                });
            }

            // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ë–ï–ì–£–ù–ö–û–í (–ü–ê–†–ê–ú–ï–¢–†–´ –ö–û–ù–°–¢–†–£–ö–¶–ò–ò)
            function updateLength(value) {
                const meters = value / 10;
                document.getElementById('length-value').textContent = meters.toFixed(1) + ' –º';
                if (window.NavesCalc) {
                    window.NavesCalc.params.length = parseInt(value);
                    window.NavesCalc.update3DModel();
                    window.NavesCalc.calculateTotal();
                    updateDebugInfo();
                }
            }

            function updateWidth(value) {
                const meters = value / 10;
                document.getElementById('width-value').textContent = meters.toFixed(1) + ' –º';
                if (window.NavesCalc) {
                    window.NavesCalc.params.width = parseInt(value);
                    window.NavesCalc.update3DModel();
                    window.NavesCalc.calculateTotal();
                    updateDebugInfo();
                }
            }

            function updateHeight(value) {
                const meters = value / 10;
                document.getElementById('height-value').textContent = meters.toFixed(1) + ' –º';
                if (window.NavesCalc) {
                    window.NavesCalc.params.height = parseInt(value);
                    window.NavesCalc.update3DModel();
                    window.NavesCalc.calculateTotal();
                    updateDebugInfo();
                }
            }

            function updateRoofHeight(value) {
                const meters = value / 10;
                document.getElementById('roof-height-value').textContent = meters.toFixed(1) + ' –º';
                if (window.NavesCalc) {
                    window.NavesCalc.params.roofHeight = parseInt(value);
                    window.NavesCalc.update3DModel();
                    window.NavesCalc.calculateTotal();
                    updateDebugInfo();
                }
            }

            function updatePostSpacing(value) {
                const meters = value / 10;
                document.getElementById('post-spacing-value').textContent = meters.toFixed(1) + ' –º';
                if (window.NavesCalc) {
                    window.NavesCalc.params.postSpacing = parseInt(value);
                    window.NavesCalc.update3DModel();
                    window.NavesCalc.calculateTotal();
                    updateDebugInfo();
                }
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Ñ–µ—Ä–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            function initTrussSelection() {
                const defaultTrussItem = document.querySelector('.debug-truss-item input[checked]');
                if (defaultTrussItem) {
                    const parent = defaultTrussItem.closest('.debug-truss-item');
                    if (parent) {
                        parent.style.border = '2px solid #20B5B9';
                        parent.style.background = '#f0fbfb';
                    }
                }
            }
        </script>

</body>

</html>